(()=>{var e={4040:(e,t,a)=>{"use strict";var l=a(1957),o=a(1947),s=a(499),i=a(9835);function r(e,t,a,l,o,s){const r=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(r)}const n=(0,i.aZ)({name:"App"});var d=a(1639);const u=(0,d.Z)(n,[["render",r]]),c=u;var m=a(3340),p=a(8339);const h=(0,i._)("div",{style:{position:"absolute",bottom:"0",left:"0",color:"white"},class:"text-h7"}," © DeCode, 2023 ",-1);function w(e,t,a,l,o,s){const r=(0,i.up)("authorization");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(r,{class:"absolute-center"}),h],64)}var g=a(2778),f=a.n(g);function y(e,t,a,l,o,s){const r=(0,i.up)("q-img"),n=(0,i.up)("q-card-section"),d=(0,i.up)("q-tab"),u=(0,i.up)("q-tabs"),c=(0,i.up)("q-separator"),m=(0,i.up)("router-view"),p=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(p,{class:"my-card absolute-center",flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)(r,{style:{width:"100px"},src:f()})])),_:1}),(0,i.Wm)(u,{modelValue:o.tab,"onUpdate:modelValue":t[1]||(t[1]=e=>o.tab=e),"active-color":"white",class:"text-teal"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.tabPanels,(e=>((0,i.wg)(),(0,i.j4)(d,{label:e.lable,name:e.name,class:"text",onClick:t[0]||(t[0]=e=>s.changeTab())},null,8,["label","name"])))),256))])),_:1},8,["modelValue"]),(0,i.Wm)(c),(0,i.Wm)(m)])),_:1})}a(9665);function _(e,t,a,l,o,s){const r=(0,i.up)("q-input"),n=(0,i.up)("q-separator"),d=(0,i.up)("q-icon"),u=(0,i.up)("q-card-section"),c=(0,i.up)("q-btn"),m=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(m,{style:{"background-color":"#fafafa"},flat:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(r,{filled:"",modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.name=e),label:"Имя пользователя"},null,8,["modelValue"]),(0,i.Wm)(n),(0,i.Wm)(r,{filled:"",modelValue:o.username,"onUpdate:modelValue":t[1]||(t[1]=e=>o.username=e),label:"Адрес эл.почты"},null,8,["modelValue"]),(0,i.Wm)(n),(0,i.Wm)(r,{filled:"",modelValue:o.password,"onUpdate:modelValue":t[3]||(t[3]=e=>o.password=e),type:o.isPwd?"password":"text",label:"Пароль"},{append:(0,i.w5)((()=>[(0,i.Wm)(d,{name:o.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[2]||(t[2]=e=>o.isPwd=!o.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type"]),(0,i.Wm)(n),(0,i.Wm)(r,{filled:"",modelValue:o.password_agan,"onUpdate:modelValue":t[4]||(t[4]=e=>o.password_agan=e),type:o.isPwd?"password":"text",label:"Подтверждение пароля"},null,8,["modelValue","type"])])),_:1}),(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{flat:"",label:"Зарегистрироваться",onClick:s.register,class:"button"},null,8,["onClick"])])),_:1})])),_:1})}var b=a(1569),v=a(7126),V=a.n(v);const k={data(){return{name:"",username:"",password:"",password_agan:"",isPwd:(0,s.iH)(!0)}},methods:{onError(e){e.response&&e.response.status?this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка при регистрации"}):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async register(){if(""!=this.name)if(""!=this.username)if(""!=this.password)if(this.password.length<4)this.$q.notify({type:"negative",message:"Длинна пароля должна ревышать 4 символа!"});else if(""!=this.password_agan)if(this.password_agan==this.password)try{await b.api.post("auth/register",{name:this.name,username:this.username,password:this.password});const e=await b.api.post("auth/login",{username:this.username,password:this.password}),t=e.data.token,a=this.username,l=e.data.name;V().set("token",t,"10h"),V().set("uname",l,"10h"),V().set("login",a,"10h"),this.$q.notify({type:"positive",message:"Пользователь успешно зарегистрирован и авторизирован"}),this.$router.replace("/")}catch(e){this.onError(e)}else this.$q.notify({type:"negative",message:"Пароли не совпадают!"});else this.$q.notify({type:"negative",message:"Введите пароль повторно!"});else this.$q.notify({type:"negative",message:"Введите пароль!"});else this.$q.notify({type:"negative",message:"Логин не может быть пустым!"});else this.$q.notify({type:"negative",message:"Имя пользователя не указано!"})}}};var W=a(4458),x=a(3190),q=a(3119),S=a(926),U=a(2857),D=a(4455),C=a(9984),E=a.n(C);const T=(0,d.Z)(k,[["render",_],["__scopeId","data-v-fc86b914"]]),M=T;function z(e,t,a,l,o,s){const r=(0,i.up)("q-input"),n=(0,i.up)("q-separator"),d=(0,i.up)("q-icon"),u=(0,i.up)("q-card-section"),c=(0,i.up)("q-btn"),m=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(m,{style:{"background-color":"#fafafa"},flat:""},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(r,{filled:"",modelValue:o.username,"onUpdate:modelValue":t[0]||(t[0]=e=>o.username=e),label:"Адрес эл.почты"},null,8,["modelValue"]),(0,i.Wm)(n),(0,i.Wm)(r,{filled:"",modelValue:o.password,"onUpdate:modelValue":t[2]||(t[2]=e=>o.password=e),type:o.isPwd?"password":"text",label:"Пароль"},{append:(0,i.w5)((()=>[(0,i.Wm)(d,{name:o.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=e=>o.isPwd=!o.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type"])])),_:1}),(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{flat:"",label:"Войти",onClick:s.login,class:"button"},null,8,["onClick"])])),_:1})])),_:1})}E()(k,"components",{QCard:W.Z,QCardSection:x.Z,QInput:q.Z,QSeparator:S.Z,QIcon:U.Z,QBtn:D.Z});const A={data(){return{username:"",password:"",isPwd:(0,s.iH)(!0)}},methods:{onError(e){e.response&&e.response.status?this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"}):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async login(){if(""!=this.username)if(""!=this.password)try{const e=await b.api.post("auth/login",{username:this.username,password:this.password}),t=e.data.token,a=this.username,l=e.data.name,o=e.data.roles;o.includes("MODERATOR")||o.includes("ADMIN")?(V().set("token",t,"10h"),V().set("uname",l,"10h"),V().set("login",a,"10h"),V().set("roles",o,"10h"),this.$q.notify({type:"positive",message:"Пользователь успешно авторизован."}),this.$router.replace({name:"map_inside"})):this.$q.notify({type:"negative",message:"Доступ запрещен!"})}catch(e){this.onError(e)}else this.$q.notify({type:"negative",message:"Введите пароль"});else this.$q.notify({type:"negative",message:"Введите адресс эл.почты"})}}},Z=(0,d.Z)(A,[["render",z],["__scopeId","data-v-495a220a"]]),N=Z;E()(A,"components",{QCard:W.Z,QCardSection:x.Z,QInput:q.Z,QSeparator:S.Z,QIcon:U.Z,QBtn:D.Z});const j={param:{page:{type:String,default:"login"}},components:{Registr:M,Login:N},data(){return{tab:(0,s.iH)("login"),tabPanels:[{name:"login",lable:"Авторизация"},{name:"registr",lable:"Регистрация"}]}},methods:{changeTab(){this.$router.push({name:this.tab})}},beforeMount(){this.$router.push({name:this.tab})}};var L=a(335),Q=a(7817),I=a(900);const O=(0,d.Z)(j,[["render",y],["__scopeId","data-v-50822b98"]]),P=O;E()(j,"components",{QCard:W.Z,QCardSection:x.Z,QImg:L.Z,QTabs:Q.Z,QTab:I.Z,QSeparator:S.Z});const H={components:{Authorization:P}},$=(0,d.Z)(H,[["render",w]]),F=$;var B=a(6970),Y=a(577),R=a.n(Y);const G={class:"q-pt-md q-pr-md text-h6"};function K(e,t,a,l,o,s){const r=(0,i.up)("q-btn"),n=(0,i.up)("q-toolbar-title"),d=(0,i.up)("q-toolbar"),u=(0,i.up)("q-header"),c=(0,i.up)("q-img"),m=(0,i.up)("q-separator"),p=(0,i.up)("q-icon"),h=(0,i.up)("q-item-section"),w=(0,i.up)("q-item"),g=(0,i.up)("q-list"),f=(0,i.up)("q-drawer"),y=(0,i.up)("router-view"),_=(0,i.up)("q-page"),b=(0,i.up)("q-page-container"),v=(0,i.up)("q-footer"),V=(0,i.up)("q-layout"),k=(0,i.Q2)("ripple");return(0,i.wg)(),(0,i.j4)(V,{view:"lHh Lpr lFf"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{reveal:"",class:"background"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Wm)(r,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:e.toggleLeftDrawer},null,8,["onClick"]),(0,i.Wm)(n,{class:"text-h5"},{default:(0,i.w5)((()=>[(0,i.Uk)("Личный кабинет")])),_:1}),(0,i._)("p",G,(0,B.zw)(e.name),1),(0,i.Wm)(r,{onClick:t[0]||(t[0]=t=>e.logout()),flat:"",round:"",icon:"logout"})])),_:1})])),_:1}),(0,i.Wm)(f,{modelValue:e.leftDrawerOpen,"onUpdate:modelValue":t[1]||(t[1]=t=>e.leftDrawerOpen=t),"show-if-above":"",width:250,breakpoint:600},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{class:"q-ma-lg",style:{width:"200px"},src:R()}),(0,i.Wm)(m),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.navigation,((t,a)=>((0,i.wg)(),(0,i.iD)("div",{key:a},[(0,i.wy)(((0,i.wg)(),(0,i.j4)(w,{exact:"",clickable:"",onClick:a=>e.navugate(t.route),active:e.currentRoute==t.route,"active-class":"my-menu-link"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{name:t.iconName},null,8,["name"])])),_:2},1024),(0,i.Wm)(h,{class:"text-h7"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(t.label),1)])),_:2},1024)])),_:2},1032,["onClick","active"])),[[k]])])))),128))])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{style:{margin:"0px 24px 0px 24px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(y)])),_:1})])),_:1}),(0,i.Wm)(v,{class:"footer"},{default:(0,i.w5)((()=>[(0,i.Uk)(" © DeCode, 2023 ")])),_:1})])),_:1})}function J(e,t,a,l,o,s){const r=(0,i.up)("q-icon"),n=(0,i.up)("q-item-section"),d=(0,i.up)("q-item-label"),u=(0,i.up)("q-item");return(0,i.wg)(),(0,i.j4)(u,{clickable:"",tag:"a",target:"_blank",href:e.link},{default:(0,i.w5)((()=>[e.icon?((0,i.wg)(),(0,i.j4)(n,{key:0,avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{name:e.icon},null,8,["name"])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.title),1)])),_:1}),(0,i.Wm)(d,{caption:""},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.caption),1)])),_:1})])),_:1})])),_:1},8,["href"])}const X=(0,i.aZ)({name:"EssentialLink",props:{title:{type:String,required:!0},caption:{type:String,default:""},link:{type:String,default:"#"},icon:{type:String,default:""}}});var ee=a(490),te=a(1233),ae=a(3115);const le=(0,d.Z)(X,[["render",J]]),oe=le;E()(X,"components",{QItem:ee.Z,QItemSection:te.Z,QIcon:U.Z,QItemLabel:ae.Z});const se=(0,i.aZ)({name:"MainLayout",components:{EssentialLink:oe,Login:P},data(){return{currentRoute:"",navigation:[{label:"Карта школ",route:"map_inside",iconName:"map"},{label:"Редактирование данных ",route:"dataedit",iconName:"storage"},{label:"Статистика",route:"statistic",iconName:"query_stats",base:!0},{label:"Профиль",route:"profile",iconName:"account_circle"},{label:"Техническая поддержка",route:"techsupport",iconName:"help_outline"}],name:V().get("uname"),token:V().get("token")}},setup(){const e=(0,s.iH)(!1);return{leftDrawerOpen:e,toggleLeftDrawer(){e.value=!e.value}}},methods:{logout(){V().remove("token"),V().remove("uname"),window.location.reload()},navugate(e){if(this.currentRoute=e,"map"==this.currentRoute){const e=this.$router.resolve({name:this.currentRoute});window.open(e.href,"_blank")}else this.$router.push({name:this.currentRoute})},reroute(){V().get("token")||this.$router.replace("/auth")}},beforeMount(){this.reroute(),this.$route.name?this.currentRoute=this.$route.name:this.currentRoute=this.navigation[0].route,"/"==this.$router.currentRoute.value.fullPath&&this.$router.push({name:this.currentRoute})},beforeUpdate(){this.reroute(),this.$router.push({name:this.currentRoute})}});var ie=a(7605),re=a(6602),ne=a(1663),de=a(1973),ue=a(906),ce=a(3246),me=a(2133),pe=a(9885),he=a(1378),we=a(1722);const ge=(0,d.Z)(se,[["render",K],["__scopeId","data-v-e1eedab4"]]),fe=ge;E()(se,"components",{QLayout:ie.Z,QHeader:re.Z,QToolbar:ne.Z,QBtn:D.Z,QToolbarTitle:de.Z,QDrawer:ue.Z,QList:ce.Z,QImg:L.Z,QSeparator:S.Z,QItem:ee.Z,QItemSection:te.Z,QIcon:U.Z,QPageContainer:me.Z,QPage:pe.Z,QFooter:he.Z}),E()(se,"directives",{Ripple:we.Z});var ye=a(913),_e=a.n(ye);const be=e=>((0,i.dD)("data-v-7cc60b36"),e=e(),(0,i.Cn)(),e),ve={class:"text-white text-center"},Ve={class:"absolute-center"},ke=be((()=>(0,i._)("img",{class:"image",src:_e()},null,-1))),We=be((()=>(0,i._)("div",{class:"text-h2 transparent-text"},[(0,i.Uk)(" Страница, которую вы ищете "),(0,i._)("br"),(0,i.Uk)(" не существует. ")],-1)));function xe(e,t,a,l,o,s){const r=(0,i.up)("particles"),n=(0,i.up)("q-btn");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(r),(0,i._)("div",ve,[(0,i._)("div",Ve,[ke,We,(0,i.Wm)(n,{class:"q-mt-sm text-h6 transparent-text","text-color":"white",unelevated:"",to:"/",label:"Вернуться на главную","no-caps":""})])])],64)}const qe={id:"particles-js",class:"normal_gradient"};function Se(e,t,a,l,o,s){return(0,i.wg)(),(0,i.iD)("div",qe)}const Ue={mounted(){particlesJS("particles-js",{particles:{number:{value:25,density:{enable:!0,value_area:631.3280775270874}},color:{value:"#fff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5}},opacity:{value:.5,random:!0,anim:{enable:!1,speed:1,opacity_min:.1,sync:!1}},size:{value:30,random:!0,anim:{enable:!1,speed:40,size_min:20,sync:!1}},line_linked:{enable:!1,distance:500,color:"#ffffff",opacity:.4,width:2},move:{enable:!0,speed:.5,direction:"top",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!1,mode:"bubble"},onclick:{enable:!0,mode:"repulse"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:.5}},bubble:{distance:400,size:4,duration:.3,opacity:1,speed:1},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})}},De=(0,d.Z)(Ue,[["render",Se]]),Ce=De,Ee=(0,i.aZ)({name:"ErrorNotFound",components:{Particles:Ce}}),Te=(0,d.Z)(Ee,[["render",xe],["__scopeId","data-v-7cc60b36"]]),Me=Te;function ze(e,t,a,l,o,s){const r=(0,i.up)("Bar");return(0,i.wg)(),(0,i.j4)(r)}E()(Ee,"components",{QBtn:D.Z});a(6204);var Ae=a(918),Ze=a.n(Ae);const Ne={class:"text-h5",style:{display:"inline-block","vertical-align":"middle"}},je={style:{display:"inline-block"}};function Le(e,t,a,l,o,s){const r=(0,i.up)("q-icon"),n=(0,i.up)("q-card-section");return(0,i.wg)(),(0,i.j4)(n,null,{default:(0,i.w5)((()=>[(0,i._)("div",Ne,(0,B.zw)(a.title),1),(0,i._)("div",je,[(0,i.Wm)(r,{size:"24px",color:"grey-8",style:{"margin-left":"10px"},name:a.iconName},null,8,["name"])])])),_:1})}const Qe={props:{title:String,iconName:String},data(){return{}}},Ie=(0,d.Z)(Qe,[["render",Le]]),Oe=Ie;E()(Qe,"components",{QCardSection:x.Z,QIcon:U.Z});var Pe=a(8505),He=a(3725),$e=a(8140),Fe=a(7929),Be=a(5946),Ye=a(934),Re=a(3935),Ge=a(5893),Ke=a(6273),Je=a(5657),Xe=a(1202),et=a(9733),tt=a(5605),at=a(2060),lt=a(4609),ot=a(4835),st=a(400),it=a(6996),rt=a(2933),nt=a(1823),dt=a(1103),ut=a(5213),ct=a(6646);const mt=e=>((0,i.dD)("data-v-636f2ea6"),e=e(),(0,i.Cn)(),e),pt={class:"row"},ht={class:"col-auto"},wt={class:"text-subtitle2"},gt={class:"col-auto"},ft={class:"text-subtitle2"},yt={class:"row"},_t={class:"col-8",style:{display:"flex","flex-direction":"column"}},bt={class:"text-h6 inline"},vt={class:"inline"},Vt={key:0,class:"inline"},kt={class:"text-subtitle2"},Wt={key:1,style:{display:"flex","justify-content":"center","align-items":"center","flex-grow":"3"}},xt=mt((()=>(0,i._)("img",{class:"image-center",src:Ze()},null,-1))),qt={class:"text-subtitle2"},St={class:"col-4",style:{display:"flex","flex-direction":"column","min-width":"300px"}},Ut=mt((()=>(0,i._)("div",{class:"text-h6 inline"}," Возраст зарегистрированных пользователей ",-1))),Dt={key:0,class:"inline"},Ct={class:"text-subtitle2"},Et={key:1,style:{display:"flex","justify-content":"center","align-items":"center","flex-grow":"3"}},Tt=mt((()=>(0,i._)("img",{class:"image-center",src:Ze()},null,-1))),Mt={class:"text-subtitle2"},zt={class:"row justify-between"},At={class:"col-8",style:{display:"flex","flex-direction":"column"}},Zt={class:"text-h6 inline"},Nt={class:"inline"},jt={key:0,class:"inline"},Lt={class:"text-subtitle2"},Qt={key:1,style:{display:"flex","justify-content":"center","align-items":"center","flex-grow":"3"}},It=mt((()=>(0,i._)("img",{class:"image-center",src:Ze()},null,-1))),Ot={class:"text-subtitle2"},Pt={class:"col-4",style:{display:"flex","flex-direction":"column"}},Ht=mt((()=>(0,i._)("div",{class:"text-h6 inline"},"Популярные",-1))),$t={class:"row justify-between"},Ft={class:"col-5"},Bt={class:"row justify-between"},Yt={class:"col-8",style:{display:"flex","flex-direction":"column"}},Rt={class:"text-h6 inline"},Gt={class:"inline"},Kt={key:0,class:"inline"},Jt={class:"text-subtitle2"},Xt={key:1,style:{display:"flex","justify-content":"center","align-items":"center","flex-grow":"3"}},ea=mt((()=>(0,i._)("img",{class:"image-center",src:Ze()},null,-1))),ta={class:"text-subtitle2"},aa={class:"col-4",style:{display:"flex","flex-direction":"column"}},la=mt((()=>(0,i._)("div",{class:"text-h6 inline"},"Популярные",-1))),oa={class:"row justify-between"},sa={class:"col-5"},ia={class:"row justify-between"},ra={class:"col-8",style:{display:"flex","flex-direction":"column"}},na={class:"text-h6 inline"},da={class:"inline"},ua={key:0,class:"inline"},ca={class:"text-subtitle2"},ma={key:1,style:{display:"flex","justify-content":"center","align-items":"center","flex-grow":"3"}},pa=mt((()=>(0,i._)("img",{class:"image-center",src:Ze()},null,-1))),ha={class:"text-subtitle2"},wa={class:"col-4",style:{display:"flex","flex-direction":"column"}},ga=mt((()=>(0,i._)("div",{class:"text-h6 inline"},"Популярные",-1))),fa={class:"row justify-between"},ya={class:"col-5"},_a={components:{Caption:Oe},beforeMount(){this.getAgeParams(),this.getUsers(),this.getDownload(),this.getSchool(),this.getFact(),this.getEvent(),this.getTodayRegUsers(),this.getTodayDownload(),this.downloadOptions.xAxis.data=Object.values(this.mounth),this.schoolOptions.xAxis.data=Object.values(this.mounth),this.factOptions.xAxis.data=Object.values(this.mounth),this.eventOptions.xAxis.data=Object.values(this.mounth)},data(){return{auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",mounth:{1:"Январь",2:"Февраль",3:"Март",4:"Апрель",5:"Май",6:"Июнь",7:"Июль",8:"Август",9:"Сентябрь",10:"Октябрь",11:"Ноябрь",12:"Дакабрь"},schools:[],facts:[],events:[],startYear:"2022",ageParams:[],registredUsers:[],countOfRegUsers:0,ageRegData:{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"horizontal",bottom:0,data:this.ageParams},series:[{name:"",type:"pie",color:["#738664","#74B076","#95AF3D","#C6D75E","#F8F5C7"],radius:"70%",center:["50%","40%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 1)"}}}]},downloads:[],downloadOptions:{grid:{top:20,right:40,bottom:80,left:40},legend:{bottom:0,right:0,textStyle:{color:"#676767"}},xAxis:{type:"category",data:[]},yAxis:{type:"value",axisLine:{lineStyle:{color:"grey"},show:!1},axisTick:{show:!1},axisLabel:{color:this.$q.dark.isActive?"white":"#676767"}},series:[],tooltip:{trigger:"axis"}},allYearsSchoolData:[],currentPeriodSchoolData:[],getCountOfSchoolYearWatch:0,schoolOptions:{grid:{top:20,right:40,bottom:80,left:40},legend:{bottom:0,right:0,textStyle:{color:"#676767"}},xAxis:{type:"category",data:[]},yAxis:{type:"value",axisLine:{lineStyle:{color:"grey"},show:!1},axisTick:{show:!1},axisLabel:{color:this.$q.dark.isActive?"white":"#676767"}},series:this.currentPeriodSchoolData,tooltip:{trigger:"axis"}},search:"",schoolCols:[{name:"name",label:"Название школы",align:"left",field:"name",sortable:!0},{name:"view",label:"Просмотры",align:"left",field:"viewCount",sortable:!0}],searchFact:"",allYearsfactData:[],currentPeriodFactData:[],getCountOfFactYearWatch:0,factOptions:{grid:{top:20,right:40,bottom:80,left:40},legend:{bottom:0,right:0,textStyle:{color:"#676767"}},xAxis:{type:"category",data:[]},yAxis:{type:"value",axisLine:{lineStyle:{color:"grey"},show:!1},axisTick:{show:!1},axisLabel:{color:this.$q.dark.isActive?"white":"#676767"}},series:this.currentPeriodSchoolData,tooltip:{trigger:"axis"}},factCols:[{name:"name",label:"Название факта",align:"left",field:"fact_name",sortable:!0},{name:"view",label:"Просмотры",align:"left",field:"viewCount",sortable:!0},{name:"like",label:"Лайки",align:"left",field:"likeCount",sortable:!0}],searchEvent:"",allYearsEventData:[],currentPeriodEventData:[],getCountOfEventYearWatch:0,eventOptions:{grid:{top:20,right:40,bottom:80,left:40},legend:{bottom:0,right:0,textStyle:{color:"#676767"}},xAxis:{type:"category",data:[]},yAxis:{type:"value",axisLine:{lineStyle:{color:"grey"},show:!1},axisTick:{show:!1},axisLabel:{color:this.$q.dark.isActive?"white":"#676767"}},series:this.currentPeriodSchoolData,tooltip:{trigger:"axis"}},eventCols:[{name:"name",label:"Название события",align:"left",field:"name",sortable:!0},{name:"view",label:"Просмотры",align:"left",field:"viewCount",sortable:!0}],todayStats:{downloadCountToday:0,registrationCountToday:0},yearModel:(new Date).getFullYear().toString(),yearModelSchool:(new Date).getFullYear().toString(),yearModelFact:(new Date).getFullYear().toString(),yearModelEvent:(new Date).getFullYear().toString()}},computed:{getYearList(){let e=[],t=(new Date).getFullYear().toString();for(let a=this.startYear;a<=t;a++)e.push(a);return e},getSchoolRows(){return this.getRows(this.schools,this.search)},getFcatRows(){return this.getRows(this.facts,this.searchFact,"fact_name")},getEventRows(){return this.getRows(this.events,this.searchEvent)}},methods:{getRows(e,t,a="name"){if(""!==t){let l=t,o=[];return e.map((function(e){e[a].toString().toLowerCase().includes(l.toString().toLowerCase())&&o.push(e)})),o}return e},exportTable(e,t){const a=[e.map((e=>this.wrapCsvValue(e.label)))].concat(t.map((t=>e.map((e=>this.wrapCsvValue("function"===typeof e.field?e.field(t):t[void 0===e.field?e.name:e.field],e.format,t))).join(",")))).join("\r\n"),l=(0,ct.Z)("table-export.csv",a,"text/csv");!0!==l&&$q.notify({message:"Ошибка загрузки",color:"negative",icon:"warning"})},wrapCsvValue(e,t){let a=void 0!==t?t(e):e;return a=void 0===a||null===a?"":String(a),a=a.split('"').join('""'),`"${a}"`},async getAgeParams(){try{const e=await b.api.get("auth/getAgeParams",{headers:{Authorization:"Bearer "+V().get("token")}});this.rows=e.data,this.ageParams=e.data.ageParams}catch(e){this.onError(e)}},formDataForPie(){this.countOfRegUsers=0;let e=[];this.ageParams.forEach((t=>{e.push({value:0,name:t})})),this.registredUsers.forEach((t=>{let a=this.ageParams.indexOf(t.age);-1!=a&&(e[a].value++,this.countOfRegUsers++)}));let t=!0;return e.forEach((e=>{0!=e.value&&(t=!1)})),t&&(e=[]),e},async getUsers(){let e=Number("все время"==this.yearModel?this.startYear:this.yearModel)-1,t=Number("все время"==this.yearModel?(new Date).getFullYear().toString():this.yearModel)+1,a=e+"-12-31",l=t+"-01-01";try{const e=await b.api.post("auth/getCreated",{start:a,end:l},{headers:{Authorization:"Bearer "+V().get("token")}});this.registredUsers=e.data,this.ageRegData.series[0].data=this.formDataForPie()}catch(o){this.onError(o)}},async getTodayRegUsers(){let e=new Date,t=String(e.getDate()-1).padStart(2,"0"),a=String(e.getDate()+1).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();try{const e=await b.api.post("auth/getCreated",{start:`${o}-${l}-${t}`,end:`${o}-${l}-${a}`},{headers:{Authorization:"Bearer "+V().get("token")}});this.todayStats.registrationCountToday=e.data.length}catch(s){this.onError(s)}},async getTodayDownload(){let e=new Date,t=String(e.getDate()-1).padStart(2,"0"),a=String(e.getDate()+1).padStart(2,"0"),l=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();try{const e=await b.api.post("api/user/getCreated/",{start:`${o}-${l}-${t}`,end:`${o}-${l}-${a}`},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.todayStats.downloadCountToday=e.data.length}catch(s){this.onError(s)}},async getDownload(){let e=Number("все время"==this.yearModel?this.startYear:this.yearModel)-1,t=Number("все время"==this.yearModel?(new Date).getFullYear().toString():this.yearModel)+1,a=e+"-12-31",l=t+"-01-01";try{const o=await b.api.post("api/user/getCreated/",{start:a,end:l},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.downloads=o.data,this.downloadOptions.series=this.formDownloadDataForGraph(e+1,t-1)}catch(o){this.onError(o)}},formDownloadDataForGraph(e,t){let a=[],l=[];for(let s=e;s<=t;s++)a.push(s.toString()),l.push({year:s.toString(),values:[0,0,0,0,0,0,0,0,0,0,0,0]});this.downloads.forEach((e=>{let t=e.create_date.split("-"),o=a.indexOf(t[0].toString());-1!=o&&l[o].values[Number(t[1])-1]++}));let o=[];return l.forEach((e=>{o.push({name:e.year,data:e.values,type:"bar",color:"#95AF3D",smooth:!0})})),o},async getSchool(){try{const e=await b.api.get("api/school",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});let t=e.data;t.forEach((e=>{if(null==e.views)e.views=[],e["viewCount"]=0;else{let t=[];Object.values(e.views).forEach((e=>{t.push(e.views[0])})),e.views=t,e["viewCount"]=t.length}})),this.schools=t,this.allYearsSchoolData=this.getSchoolsInPeriodDiagramm(),this.currentPeriodSchoolData=this.setSchoolsCurrent(),this.schoolOptions.series=this.currentPeriodSchoolData}catch(e){this.onError(e)}},getSchoolsInPeriodDiagramm(){let e=(new Date).getFullYear().toString(),t=Number(this.startYear)-1,a=Number(e)+1,l=t+"-12-31",o=a+"-01-01",s=new Date(l),i=new Date(o),r=[],n=[];for(let u=this.startYear;u<=e;u++)n.push(u.toString()),r.push({year:u.toString(),values:[0,0,0,0,0,0,0,0,0,0,0,0]});this.schools.forEach((e=>{e.views.forEach((e=>{let t=new Date(e);if(t>s&&t<i){let t=e.split("-"),a=n.indexOf(t[0].toString());-1!=a&&r[a].values[Number(t[1])-1]++}}))}));let d=[];return r.forEach((e=>{d.push({name:e.year,data:e.values,type:"bar",color:"#95AF3D",smooth:!0})})),d},setSchoolsCurrent(){let e=[];this.allYearsSchoolData.forEach((t=>{t.name==this.yearModelSchool&&e.push(t)}));let t=0;return e[0].data.forEach((e=>{t+=e})),this.getCountOfSchoolYearWatch=t,e},async getFact(){try{const e=await b.api.get("api/fact",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});let t=e.data;t.forEach((e=>{let t=0;if(e["viewCount"]=0,null==e.views)e.views=[];else{let a=[];Object.values(e.views).forEach((e=>{a.push(e.views[0]),e.like&&t++})),e.views=a,e["viewCount"]=a.length}e["likeCount"]=t})),this.facts=t,this.allYearsfactData=this.getFactsInPeriodDiagramm(),this.currentPeriodFactData=this.setFactsCurrent(),this.factOptions.series=this.currentPeriodFactData}catch(e){this.onError(e)}},getFactsInPeriodDiagramm(){let e=(new Date).getFullYear().toString(),t=Number(this.startYear)-1,a=Number(e)+1,l=t+"-12-31",o=a+"-01-01",s=new Date(l),i=new Date(o),r=[],n=[];for(let u=this.startYear;u<=e;u++)n.push(u.toString()),r.push({year:u.toString(),values:[0,0,0,0,0,0,0,0,0,0,0,0]});this.facts.forEach((e=>{e.views.forEach((e=>{let t=new Date(e);if(t>s&&t<i){let t=e.split("-"),a=n.indexOf(t[0].toString());-1!=a&&r[a].values[Number(t[1])-1]++}}))}));let d=[];return r.forEach((e=>{d.push({name:e.year,data:e.values,type:"bar",color:"#95AF3D",smooth:!0})})),d},setFactsCurrent(){let e=[];this.allYearsfactData.forEach((t=>{t.name==this.yearModelFact&&e.push(t)}));let t=0;return e[0].data.forEach((e=>{t+=e})),this.getCountOfFactYearWatch=t,e},async getEvent(){try{const e=await b.api.get("api/event",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});let t=e.data;t.forEach((e=>{if(e["viewCount"]=0,null==e.views)e.views=[];else{let t=[];Object.values(e.views).forEach((e=>{t.push(e.views[0]),e.like&&0})),e.views=t,e["viewCount"]=t.length}})),this.events=t,this.allYearsEventData=this.getEventInPeriodDiagramm(),this.currentPeriodEventData=this.setEventsCurrent(),this.eventOptions.series=this.currentPeriodEventData}catch(e){this.onError(e)}},getEventInPeriodDiagramm(){let e=(new Date).getFullYear().toString(),t=Number(this.startYear)-1,a=Number(e)+1,l=t+"-12-31",o=a+"-01-01",s=new Date(l),i=new Date(o),r=[],n=[];for(let u=this.startYear;u<=e;u++)n.push(u.toString()),r.push({year:u.toString(),values:[0,0,0,0,0,0,0,0,0,0,0,0]});this.events.forEach((e=>{e.views.forEach((e=>{let t=new Date(e);if(t>s&&t<i){let t=e.split("-"),a=n.indexOf(t[0].toString());-1!=a&&r[a].values[Number(t[1])-1]++}}))}));let d=[];return r.forEach((e=>{d.push({name:e.year,data:e.values,type:"bar",color:"#95AF3D",smooth:!0})})),d},setEventsCurrent(){let e=[];this.allYearsEventData.forEach((t=>{t.name==this.yearModelEvent&&e.push(t)}));let t=0;return e[0].data.forEach((e=>{t+=e})),this.getCountOfEventYearWatch=t,e},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},changeDownloadData(){this.getUsers(),this.getDownload(),this.schoolOptions.series=[]},changeSchoolData(){this.currentPeriodSchoolData=this.setSchoolsCurrent(),this.schoolOptions.series=this.currentPeriodSchoolData},changeFectData(){this.currentPeriodFactData=this.setFactsCurrent(),this.factOptions.series=this.currentPeriodFactData},changeEventData(){this.currentPeriodEventData=this.setEventsCurrent(),this.eventOptions.series=this.currentPeriodEventData},SaveImage(e){const t=this.$refs[e].getDataURL(),a=document.createElement("a");document.body.appendChild(a),a.href=t,a.target="_self",a.download=e+".png",a.click()}}},ba=Object.assign(_a,{__name:"BarChart",setup(e){return(0,Pe.D)([Fe.N,Be.N,Ye.N,Re.N,Ge.N,Ke.N,Je.N,Xe.N,et.N,tt.N,at.N,lt.N,ot.N,st.N,it.N,rt.N,He.N,$e.N,nt.N,dt.N]),(0,i.JJ)(ut.bw,"light"),(e,t)=>{const a=(0,i.up)("q-separator"),l=(0,i.up)("q-card-section"),o=(0,i.up)("q-select"),r=(0,i.up)("q-tooltip"),n=(0,i.up)("q-btn"),d=(0,i.up)("q-card"),u=(0,i.up)("q-icon"),c=(0,i.up)("q-input"),m=(0,i.up)("q-table");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(d,{class:"shadow-15 block",style:{"border-radius":"14px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Oe,{title:"Скачивания приложения","icon-name":"add_reaction"}),(0,i.Wm)(l,{style:{"padding-top":"0px"}},{default:(0,i.w5)((()=>[(0,i._)("div",pt,[(0,i._)("div",ht,[(0,i._)("div",wt," Скачиваний сегодня: "+(0,B.zw)(e.todayStats.downloadCountToday),1)]),(0,i.Wm)(a,{class:"q-mr-lg q-ml-lg",vertical:"",inset:""}),(0,i._)("div",gt,[(0,i._)("div",ft," Регистраций сегодня: "+(0,B.zw)(e.todayStats.registrationCountToday),1)])])])),_:1}),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",yt,[(0,i._)("div",_t,[(0,i._)("div",null,[(0,i._)("div",bt,[(0,i.Uk)(" Динамика скачивания приложения за "),(0,i._)("div",vt,[(0,i.Wm)(o,{class:"inline",style:{"margin-left":"24px"},borderless:"",modelValue:e.yearModel,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.yearModel=t),e.changeDownloadData],modelModifiers:{lazy:!0},options:e.getYearList},null,8,["modelValue","onUpdate:modelValue","options"])])]),e.downloads.length>0?((0,i.wg)(),(0,i.iD)("div",Vt,[(0,i.Wm)(n,{flat:"",dense:"",icon:"download",size:"m",class:"mr-10",onClick:t[1]||(t[1]=t=>e.SaveImage("downloads")),color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Скачать")])),_:1})])),_:1})])):(0,i.kq)("",!0)]),(0,i._)("div",kt," Всего скачиваний за "+(0,B.zw)(e.yearModel)+": "+(0,B.zw)(e.downloads.length),1),e.downloads.length>0?((0,i.wg)(),(0,i.j4)((0,s.SU)(ut.ZP),{key:0,class:"chart",ref:"downloads",option:e.downloadOptions,autoresize:"",style:{}},null,8,["option"])):((0,i.wg)(),(0,i.iD)("div",Wt,[(0,i._)("div",null,[xt,(0,i._)("div",qt," За "+(0,B.zw)(e.yearModel)+" данных не обнаружено ",1)])]))]),(0,i._)("div",St,[(0,i._)("div",null,[Ut,e.ageRegData.series[0].data.length>0?((0,i.wg)(),(0,i.iD)("div",Dt,[(0,i.Wm)(n,{flat:"",dense:"",icon:"download",size:"m",class:"q-pl-md",onClick:t[2]||(t[2]=t=>e.SaveImage("age")),color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Скачать")])),_:1})])),_:1})])):(0,i.kq)("",!0)]),(0,i._)("div",Ct," Всего регистраций за "+(0,B.zw)(e.yearModel)+": "+(0,B.zw)(e.countOfRegUsers),1),e.ageRegData.series[0].data.length>0?((0,i.wg)(),(0,i.j4)((0,s.SU)(ut.ZP),{class:"chart",ref:"age",option:e.ageRegData,key:Math.random(1e3),autoresize:""},null,8,["option"])):((0,i.wg)(),(0,i.iD)("div",Et,[(0,i._)("div",null,[Tt,(0,i._)("div",Mt," За "+(0,B.zw)(e.yearModel)+" данных не обнаружено ",1)])]))])])])),_:1})])),_:1}),(0,i.Wm)(d,{class:"shadow-15 block",style:{"border-radius":"14px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Oe,{title:"Школы","icon-name":"school"}),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",zt,[(0,i._)("div",At,[(0,i._)("div",null,[(0,i._)("div",Zt,[(0,i.Uk)(" Динамика просмотра школ за "),(0,i._)("div",Nt,[(0,i.Wm)(o,{class:"inline",style:{"margin-left":"24px"},borderless:"",modelValue:e.yearModelSchool,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.yearModelSchool=t),e.changeSchoolData],modelModifiers:{lazy:!0},options:e.getYearList},null,8,["modelValue","onUpdate:modelValue","options"])])]),e.currentPeriodSchoolData.length>0?((0,i.wg)(),(0,i.iD)("div",jt,[(0,i.Wm)(n,{flat:"",dense:"",icon:"download",size:"m",class:"mr-10",onClick:t[4]||(t[4]=t=>e.SaveImage("schools")),color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Скачать")])),_:1})])),_:1})])):(0,i.kq)("",!0)]),(0,i._)("div",Lt," Всего за "+(0,B.zw)(e.yearModelSchool)+" : "+(0,B.zw)(e.getCountOfSchoolYearWatch),1),e.currentPeriodSchoolData.length>0?((0,i.wg)(),(0,i.j4)((0,s.SU)(ut.ZP),{key:0,class:"chart",ref:"schools",autoresize:"",option:e.schoolOptions},null,8,["option"])):((0,i.wg)(),(0,i.iD)("div",Qt,[(0,i._)("div",null,[It,(0,i._)("div",Ot," За "+(0,B.zw)(e.yearModelSchool)+" данных не обнаружено ",1)])]))]),(0,i._)("div",Pt,[(0,i._)("div",null,[Ht,(0,i.Wm)(n,{flat:"",class:"inline",color:"grey-8",icon:"download",label:"CSV","no-caps":"",onClick:t[5]||(t[5]=t=>e.exportTable(e.schoolCols,e.schoolRows))},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Экспортировать в CSV")])),_:1})])),_:1})]),(0,i._)("div",$t,[(0,i._)("div",Ft,[(0,i.Wm)(c,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:e.search,"onUpdate:modelValue":t[6]||(t[6]=t=>e.search=t),label:"Поиск по названию"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(u,{name:"search"})])),_:1},8,["modelValue"])])]),(0,i.Wm)(a),(0,i.Wm)(m,{flat:"",borderless:"",separator:"cell","row-key":"name",rows:e.getSchoolRows,columns:e.schoolCols,color:"primary","no-data-label":"Ничего не найдено"},null,8,["rows","columns"])])])])),_:1})])),_:1}),(0,i.Wm)(d,{class:"shadow-15 block",style:{"border-radius":"14px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Oe,{title:"Факты","icon-name":"history_edu"}),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",Bt,[(0,i._)("div",Yt,[(0,i._)("div",null,[(0,i._)("div",Rt,[(0,i.Uk)(" Динамика просмотра фактов за "),(0,i._)("div",Gt,[(0,i.Wm)(o,{class:"inline",style:{"margin-left":"24px"},borderless:"",modelValue:e.yearModelFact,"onUpdate:modelValue":[t[7]||(t[7]=t=>e.yearModelFact=t),e.changeFectData],modelModifiers:{lazy:!0},options:e.getYearList},null,8,["modelValue","onUpdate:modelValue","options"])])]),e.currentPeriodFactData.length>0?((0,i.wg)(),(0,i.iD)("div",Kt,[(0,i.Wm)(n,{flat:"",dense:"",icon:"download",size:"m",class:"mr-10",onClick:t[8]||(t[8]=t=>e.SaveImage("facts")),color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Скачать")])),_:1})])),_:1})])):(0,i.kq)("",!0)]),(0,i._)("div",Jt," Всего за "+(0,B.zw)(e.yearModelFact)+" : "+(0,B.zw)(e.getCountOfFactYearWatch),1),e.currentPeriodFactData.length>0?((0,i.wg)(),(0,i.j4)((0,s.SU)(ut.ZP),{key:0,class:"chart",ref:"facts",autoresize:"",option:e.factOptions},null,8,["option"])):((0,i.wg)(),(0,i.iD)("div",Xt,[(0,i._)("div",null,[ea,(0,i._)("div",ta," За "+(0,B.zw)(e.yearModelFact)+" данных не обнаружено ",1)])]))]),(0,i._)("div",aa,[(0,i._)("div",null,[la,(0,i.Wm)(n,{flat:"",class:"inline",color:"grey-8",icon:"download",label:"CSV","no-caps":"",onClick:t[9]||(t[9]=t=>e.exportTable(e.factCols,e.facts))},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Экспортировать в CSV")])),_:1})])),_:1})]),(0,i._)("div",oa,[(0,i._)("div",sa,[(0,i.Wm)(c,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:e.searchFact,"onUpdate:modelValue":t[10]||(t[10]=t=>e.searchFact=t),label:"Поиск по названию"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(u,{name:"search"})])),_:1},8,["modelValue"])])]),(0,i.Wm)(a),(0,i.Wm)(m,{flat:"",borderless:"",separator:"cell","row-key":"name",rows:e.getFcatRows,columns:e.factCols,color:"primary","no-data-label":"Ничего не найдено"},null,8,["rows","columns"])])])])),_:1})])),_:1}),(0,i.Wm)(d,{class:"shadow-15 block",style:{"border-radius":"14px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Oe,{title:"События","icon-name":"emoji_events"}),(0,i.Wm)(l,null,{default:(0,i.w5)((()=>[(0,i._)("div",ia,[(0,i._)("div",ra,[(0,i._)("div",null,[(0,i._)("div",na,[(0,i.Uk)(" Динамика просмотра событий за "),(0,i._)("div",da,[(0,i.Wm)(o,{class:"inline",style:{"margin-left":"24px"},borderless:"",modelValue:e.yearModelEvent,"onUpdate:modelValue":[t[11]||(t[11]=t=>e.yearModelEvent=t),e.changeEventData],modelModifiers:{lazy:!0},options:e.getYearList},null,8,["modelValue","onUpdate:modelValue","options"])])]),e.currentPeriodEventData.length>0?((0,i.wg)(),(0,i.iD)("div",ua,[(0,i.Wm)(n,{flat:"",dense:"",icon:"download",size:"m",class:"mr-10",onClick:t[12]||(t[12]=t=>e.SaveImage("events")),color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Скачать")])),_:1})])),_:1})])):(0,i.kq)("",!0)]),(0,i._)("div",ca," Всего за "+(0,B.zw)(e.yearModelEvent)+" : "+(0,B.zw)(e.getCountOfEventYearWatch),1),e.currentPeriodEventData.length>0?((0,i.wg)(),(0,i.j4)((0,s.SU)(ut.ZP),{key:0,class:"chart",ref:"events",autoresize:"",option:e.eventOptions},null,8,["option"])):((0,i.wg)(),(0,i.iD)("div",ma,[(0,i._)("div",null,[pa,(0,i._)("div",ha," За "+(0,B.zw)(e.yearModelEvent)+" данных не обнаружено ",1)])]))]),(0,i._)("div",wa,[(0,i._)("div",null,[ga,(0,i.Wm)(n,{flat:"",class:"inline",color:"grey-8",icon:"download",label:"CSV","no-caps":"",onClick:t[13]||(t[13]=t=>e.exportTable(e.eventCols,e.events))},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Экспортировать в CSV")])),_:1})])),_:1})]),(0,i._)("div",fa,[(0,i._)("div",ya,[(0,i.Wm)(c,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:e.searchEvent,"onUpdate:modelValue":t[14]||(t[14]=t=>e.searchEvent=t),label:"Поиск по названию"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(u,{name:"search"})])),_:1},8,["modelValue"])])]),(0,i.Wm)(a),(0,i.Wm)(m,{flat:"",borderless:"",separator:"cell","row-key":"name",rows:e.getEventRows,columns:e.eventCols,color:"primary","no-data-label":"Ничего не найдено"},null,8,["rows","columns"])])])])),_:1})])),_:1})])}}});var va=a(6384),Va=a(6858),ka=a(1746);const Wa=(0,d.Z)(ba,[["__scopeId","data-v-636f2ea6"]]),xa=Wa;E()(ba,"components",{QCard:W.Z,QCardSection:x.Z,QSeparator:S.Z,QSelect:va.Z,QBtn:D.Z,QTooltip:Va.Z,QInput:q.Z,QIcon:U.Z,QTable:ka.Z});const qa={components:{Bar:xa},data(){return{username:"",text:"",regis:!1}},methods:{}},Sa=(0,d.Z)(qa,[["render",ze]]),Ua=Sa;function Da(e,t,a,l,o,s){const r=(0,i.up)("q-select"),n=(0,i.up)("q-card-section"),d=(0,i.up)("roles"),u=(0,i.up)("users"),c=(0,i.up)("facts"),m=(0,i.up)("event"),p=(0,i.up)("school"),h=(0,i.up)("news"),w=(0,i.up)("direction"),g=(0,i.up)("level"),f=(0,i.up)("chource"),y=(0,i.up)("test"),_=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)(r,{modelValue:o.selectedTable,"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedTable=e),options:s.getOptions,label:"Выберите таблицу, которую хотите отредактировать"},null,8,["modelValue","options"])])),_:1}),(0,i.Wm)(n,null,{default:(0,i.w5)((()=>["Роли"===o.selectedTable?((0,i.wg)(),(0,i.j4)(d,{key:0})):(0,i.kq)("",!0),"Пользователи"===o.selectedTable?((0,i.wg)(),(0,i.j4)(u,{key:1})):(0,i.kq)("",!0),"Факты"===o.selectedTable?((0,i.wg)(),(0,i.j4)(c,{key:2})):(0,i.kq)("",!0),"Мероприятия"===o.selectedTable?((0,i.wg)(),(0,i.j4)(m,{key:3})):(0,i.kq)("",!0),"Школы"===o.selectedTable?((0,i.wg)(),(0,i.j4)(p,{key:4})):(0,i.kq)("",!0),"Новости"===o.selectedTable?((0,i.wg)(),(0,i.j4)(h,{key:5})):(0,i.kq)("",!0),"Направления(теги)"===o.selectedTable?((0,i.wg)(),(0,i.j4)(w,{key:6})):(0,i.kq)("",!0),"Уровни сложности"===o.selectedTable?((0,i.wg)(),(0,i.j4)(g,{key:7})):(0,i.kq)("",!0),"Курсы"===o.selectedTable?((0,i.wg)(),(0,i.j4)(f,{key:8})):(0,i.kq)("",!0),"Тесты"===o.selectedTable?((0,i.wg)(),(0,i.j4)(y,{key:9})):(0,i.kq)("",!0)])),_:1})])),_:1})}var Ca=a(2796),Ea=a.n(Ca);const Ta=e=>((0,i.dD)("data-v-1b458fe3"),e=e(),(0,i.Cn)(),e),Ma={key:1},za={class:"row"},Aa={class:"col-auto"},Za={class:"col-auto"},Na={key:2,class:"text-center"},ja=Ta((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),La=Ta((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),Qa=[ja,La],Ia=Ta((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function Oa(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-separator"),m=(0,i.up)("q-th"),p=(0,i.up)("q-popup-edit"),h=(0,i.up)("q-td"),w=(0,i.up)("q-tooltip"),g=(0,i.up)("q-btn"),f=(0,i.up)("q-tr"),y=(0,i.up)("q-table"),_=(0,i.up)("q-card-section"),b=(0,i.up)("q-card-actions"),v=(0,i.up)("q-card"),V=(0,i.up)("q-dialog"),k=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Ma,[(0,i._)("div",za,[(0,i._)("div",Aa,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",Za,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])])]),(0,i.Wm)(c),(0,i.Wm)(y,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(m,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(f,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.name),1),(0,i.Wm)(p,{modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,onHide:t=>s.changeName(e.row._id,e.row.name,e.row.username)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Новое имя пользователя"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(h,{key:"username",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.username),1)])),_:2},1032,["props"]),(0,i.Wm)(h,{key:"registrDate",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(new Date(e.row.registrDate).toLocaleString("ru-RU",{timeZone:"Europe/Moscow"})),1)])),_:2},1032,["props"]),(0,i.Wm)(h,{key:"roles",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.roles),1),(0,i.Wm)(p,{modelValue:e.row.roles,"onUpdate:modelValue":t=>e.row.roles=t,onHide:t=>s.changeRole(e.row._id,e.row.roles,e.row.username)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:e.row.roles,"onUpdate:modelValue":t=>e.row.roles=t,options:o.roles,label:"Роль"},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(h,{key:"password"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"edit"}),(0,i.Wm)(p,{modelValue:e.row.roles,"onUpdate:modelValue":t=>e.row.roles=t,onHide:t=>s.changeUserPass(e.row._id,o.newPass)},{default:(0,i.w5)((e=>[(0,i.Wm)(d,{modelValue:o.newPass,"onUpdate:modelValue":[t[3]||(t[3]=e=>o.newPass=e),t[4]||(t[4]=e=>o.inputRef.value.resetValidation())],type:o.isPwd?"password":"text",hint:"Новый пароль"},{append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:o.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[2]||(t[2]=e=>o.isPwd=!o.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"]),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Изменить пароль")])),_:1})])),_:2},1024)])),_:2},1024),(0,i.Wm)(h,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id,o.deletUserName=e.row.username),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",Na,Qa)):(0,i.kq)("",!0)]),(0,i.Wm)(V,{modelValue:o.confirm,"onUpdate:modelValue":t[6]||(t[6]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(v,null,{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"row items-center"},{default:(0,i.w5)((()=>[Ia])),_:1}),(0,i.Wm)(b,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(g,{flat:"",label:"Отмена",color:"primary"},null,512),[[k]]),(0,i.wy)((0,i.Wm)(g,{flat:"",label:"Удалить",onClick:t[5]||(t[5]=e=>s.removeUser(o.deleteRowId,o.deletUserName)),color:"primary"},null,512),[[k]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}const Pa={data(){return{inputRef:(0,s.iH)(null),deletUserName:"",deleteRowId:-1,confirm:(0,s.iH)(!1),searchSelected:"",newPass:"",text:"",isPwd:(0,s.iH)(!0),roles:[],columns:[{name:"name",label:"Имя пользователя",align:"left",field:"name",canEdit:!0,sortable:!0},{name:"username",label:"Логин",align:"left",field:"username",canEdit:!1,sortable:!0},{name:"registrDate",align:"left",label:"Дата регистрации",field:"registrDate",canEdit:!1,sortable:!0},{name:"roles",align:"left",label:"Роль",field:"roles",canEdit:!0,sortable:!0},{name:"password",align:"left",label:"Пароль",canEdit:!0},{name:"control",align:"left",label:"Управление"}],rows:[],error:0,loaded:!1,password:(0,s.iH)(""),isPwd:(0,s.iH)(!0)}},mounted(){this.getUsers(),this.getRolesArray(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async getUsers(){this.loaded=!1,this.error=0;try{const e=await b.api.get("auth/users",{headers:{Authorization:"Bearer "+V().get("token")}});this.rows=e.data,this.rows.forEach((e=>{e.roles=e.roles[0]})),this.loaded=!0}catch(e){this.onError(e)}},async changeRole(e,t,a){try{await b.api.put("auth/updateRole",{id:e,newRole:t},{headers:{Authorization:"Bearer "+V().get("token")}}),this.$q.notify({type:"positive",message:"Роль пользователя сохранена"}),V().get("login")==a&&(V().remove("token"),window.location.reload())}catch(l){this.onError(l)}},async changeName(e,t,a){if(""!=t)try{await b.api.put("auth/updateUser/"+e,{name:t},{headers:{Authorization:"Bearer "+V().get("token")}});this.$q.notify({type:"positive",message:"Имя пользователя сохранено"}),a==V().get("login")&&(V().set("uname",t,"10h"),window.location.reload())}catch(l){this.onError(l)}else this.$q.notify({type:"negative",message:"Имя пользователя не может быть пустым"})},async getRolesArray(){this.loaded=!1,this.error=0;try{const e=await b.api.get("auth/roles",{headers:{Authorization:"Bearer "+V().get("token")}});this.roles=e.data.map((e=>e.value)),this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async removeUser(e,t){try{await b.api.post("auth/delete",{id:e},{headers:{Authorization:"Bearer "+V().get("token")}});this.loaded=!0,t==V().get("login")&&(V().remove("token"),V().remove("uname"),window.location.reload()),this.$q.notify({type:"positive",message:"Пользователь удален"}),this.getUsers()}catch(a){this.onError(a)}},async changeUserPass(e,t){const a=/^[a-zA-Z._0-9]+$/;if(a.test(t))try{await b.api.put("auth/updateUser/"+e,{password:t});this.loaded=!0,this.$q.notify({type:"positive",message:"Пароль изменен"})}catch(l){this.onError(l)}else this.$q.notify({type:"negative",message:"Проль должен содержать только разрешенные символы (_, ., a-z, A-Z, 0-9)"})}},computed:{getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e}}};var Ha=a(5304),$a=a(1682),Fa=a(3532),Ba=a(7220),Ya=a(5863),Ra=a(2074),Ga=a(1821),Ka=a(2146);const Ja=(0,d.Z)(Pa,[["render",Oa],["__scopeId","data-v-1b458fe3"]]),Xa=Ja;E()(Pa,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QPopupEdit:Ya.Z,QBtn:D.Z,QTooltip:Va.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QCardActions:Ga.Z}),E()(Pa,"directives",{ClosePopup:Ka.Z});const el=e=>((0,i.dD)("data-v-d1eaaab0"),e=e(),(0,i.Cn)(),e),tl={key:1},al={class:"row"},ll={class:"col-3"},ol={class:"col-2"},sl={key:2,class:"text-center"},il=el((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),rl=el((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),nl=[il,rl];function dl(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-separator"),m=(0,i.up)("q-th"),p=(0,i.up)("q-td"),h=(0,i.up)("q-tr"),w=(0,i.up)("q-table");return(0,i.wg)(),(0,i.iD)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",tl,[(0,i._)("div",al,[(0,i._)("div",ll,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",ol,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])])]),(0,i.Wm)(c),(0,i.Wm)(w,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(m,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(h,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{key:"value",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.value),1)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",sl,nl)):(0,i.kq)("",!0)])}const ul={data(){return{text:"",searchSelected:"",columns:[{name:"value",align:"center",label:"Роль",field:"value",canEdit:!1,sortable:!0}],rows:[],error:0,loaded:!1}},mounted(){this.roles(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async roles(){this.loaded=!1,this.error=0;try{const e=await b.api.get("auth/roles",{headers:{Authorization:"Bearer "+V().get("token")}});this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})}},computed:{getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e}}},cl=(0,d.Z)(ul,[["render",dl],["__scopeId","data-v-d1eaaab0"]]),ml=cl;E()(ul,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z});const pl=e=>((0,i.dD)("data-v-7b46b51a"),e=e(),(0,i.Cn)(),e),hl={key:1},wl={class:"row"},gl={class:"col-auto"},fl={class:"col-auto"},yl={class:"col q-mt-sm"},_l=pl((()=>(0,i._)("div",{class:"text-h6"},"Добавление нового факта",-1))),bl={key:2,class:"text-center"},vl=pl((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),Vl=pl((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),kl=[vl,Vl],Wl=pl((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function xl(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-file"),w=(0,i.up)("q-popup-edit"),g=(0,i.up)("q-tooltip"),f=(0,i.up)("q-card"),y=(0,i.up)("q-dialog"),_=(0,i.up)("q-separator"),b=(0,i.up)("q-th"),v=(0,i.up)("q-td"),V=(0,i.up)("q-chip"),k=(0,i.up)("q-item"),W=(0,i.up)("q-tr"),x=(0,i.up)("q-table"),q=(0,i.up)("q-card-actions"),S=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",hl,[(0,i._)("div",wl,[(0,i._)("div",gl,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",fl,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",yl,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[12]||(t[12]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{modelValue:o.icon,"onUpdate:modelValue":t[11]||(t[11]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[_l,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newAuthor,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newAuthor=e),label:"О ком"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newFactFooter,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newFactFooter=e),label:"Авторское право на используемое изображение"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newFactName,"onUpdate:modelValue":t[4]||(t[4]=e=>o.newFactName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newFactText,"onUpdate:modelValue":t[5]||(t[5]=e=>o.newFactText=e),label:"Текст"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newImgUrl,"onUpdate:modelValue":t[9]||(t[9]=e=>o.newImgUrl=e),label:"Ссылка на изображение"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_2,"onUpdate:modelValue":t[8]||(t[8]=e=>o.file_2=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[6]||(t[6]=e=>o.file=e),t[7]||(t[7]=e=>s.uploadFileA())],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(m,{class:"q-mt-md",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[10]||(t[10]=e=>s.addNewFacts())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(_),(0,i.Wm)(x,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(b,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(W,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{key:"author",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.author)),1),(0,i.Wm)(w,{modelValue:e.row.author,"onUpdate:modelValue":t=>e.row.author=t,onHide:t=>s.changeAuthor(e.row._id,e.row.author)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.author,"onUpdate:modelValue":t=>e.row.author=t,label:"О ком"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"fact_footer",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.fact_footer)),1),(0,i.Wm)(w,{modelValue:e.row.fact_footer,"onUpdate:modelValue":t=>e.row.fact_footer=t,onHide:t=>s.changeFooter(e.row._id,e.row.fact_footer)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.fact_footer,"onUpdate:modelValue":t=>e.row.fact_footer=t,label:"Авторское право"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"fact_name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.fact_name)),1),(0,i.Wm)(w,{modelValue:e.row.fact_name,"onUpdate:modelValue":t=>e.row.fact_name=t,onHide:t=>s.changeName(e.row._id,e.row.fact_name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.fact_name,"onUpdate:modelValue":t=>e.row.fact_name=t,label:"Название"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"fact_text",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.fact_text)),1),(0,i.Wm)(w,{modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,onHide:t=>s.changeDescription(e.row._id,e.row.fact_text)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,label:"Текст"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"image_url",props:e},{default:(0,i.w5)((()=>[e.row.image_url?((0,i.wg)(),(0,i.j4)(m,{key:0,href:e.row.image_url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(e.row.image_url))+" ",1),(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_1,"onUpdate:modelValue":t[14]||(t[14]=e=>o.file_1=e),onHide:t=>s.changeUrl(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[13]||(t[13]=e=>o.file=e),t=>s.uploadFileB(e.row._id)],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onHide"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:2},1024),(0,i.Wm)(w,{modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,onHide:t=>s.changeUrl(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,label:"Ссылка на изображение"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"tags",props:e},{default:(0,i.w5)((()=>[e.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e.row.dir,(t=>((0,i.wg)(),(0,i.iD)("div",null,[t?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(t,(t=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(V,{removable:"",clickabl:"",onRemove:a=>s.delTag(e.row._id,t.id),style:(0,B.j5)({"background-color":`${t.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(t.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(m,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(w,{modelValue:o.model,"onUpdate:modelValue":t[16]||(t[16]=e=>o.model=e),onHide:t=>s.addNewTags(e.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[15]||(t[15]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(k,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(V,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"views",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.viewCount),1)])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"like",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.likeCount),1)])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",bl,kl)):(0,i.kq)("",!0)]),(0,i.Wm)(y,{modelValue:o.confirm,"onUpdate:modelValue":t[18]||(t[18]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[Wl])),_:1}),(0,i.Wm)(q,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[S]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[17]||(t[17]=e=>s.removeFacts(o.deleteRowId)),color:"primary"},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}const ql={data(){return{file_1:null,file_2:null,file:(0,s.iH)(null),deleteRowId:-1,icon:(0,s.iH)(!1),newPass:"",text:"",confirm:(0,s.iH)(!1),roles:[],searchSelected:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",columns:[{name:"author",label:"О ком",align:"left",field:"author",canEdit:!0,sortable:!0},{name:"fact_footer",align:"left",label:"Авторское право на используемое изображение",field:"fact_footer",canEdit:!0,sortable:!0},{name:"fact_name",align:"left",label:"Название",field:"fact_name",canEdit:!0,sortable:!0},{name:"fact_text",align:"left",label:"Текст",field:"fact_text",canEdit:!0,sortable:!0},{name:"image_url",align:"left",label:"Ссылка на изображение",field:"image_url",canEdit:!0,sortable:!0},{name:"tags",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1},{name:"views",align:"left",label:"Просмотры",field:"viewCount",canEdit:!1,sortable:!0},{name:"like",align:"left",label:"Лайки",field:"likeCount",canEdit:!1,sortable:!0},{name:"control",align:"left",label:"Управление"}],rows:[],error:0,loaded:!1,newAuthor:"",newFactFooter:"",newFactName:"",newFactText:"",newImgUrl:"",tags:[],model:"",factTegId:""}},async beforeMount(){this.getFacts(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async getTags(){try{const e=await b.api.get("api/childDir",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},async uploadFileB(e){if(null==this.file)return;let t=new FormData;t.append("file",this.file);try{const a=await b.api.post("api/uploads/create/",t,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows.forEach((t=>{t._id==e&&(t.image_url=a.data)})),this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(a){this.onError(a)}},async uploadFileA(){if(null==this.file)return;let e=new FormData;e.append("file",this.file);try{const t=await b.api.post("api/uploads/create/",e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.newImgUrl=t.data,this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(t){this.onError(t)}},async getFacts(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/fact/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});await this.getTags(),e.data.forEach((e=>{let t=0;null!=e.views&&Object.values(e.views).forEach((e=>{e.like&&t++})),e["likeCount"]=t,e["viewCount"]=e.views?Object.values(e.views).length:0})),this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async removeFacts(e){try{await b.api["delete"]("api/fact/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.loaded=!0,this.$q.notify({type:"positive",message:"Факт удален"}),this.getFacts()}catch(t){this.onError(t)}},async changeAuthor(e,t){try{await b.api.put("api/fact/"+e,{author:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Автор сохранен"})}catch(a){this.onError(a)}},async changeFooter(e,t){try{await b.api.put("api/fact/"+e,{fact_footer:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Копирайт сохранен"})}catch(a){this.onError(a)}},async changeName(e,t){try{await b.api.put("api/fact/"+e,{fact_name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Название сохранено"})}catch(a){this.onError(a)}},async changeDescription(e,t){try{await b.api.put("api/fact/"+e,{fact_text:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Автор сохранен"})}catch(a){this.onError(a)}},async changeUrl(e,t){try{await b.api.put("api/fact/"+e,{image_url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка сохранена"})}catch(a){this.onError(a)}},async addNewFacts(){try{await b.api.post("api/fact",{author:this.newAuthor,fact_footer:this.newFactFooter,fact_name:this.newFactName,fact_text:this.newFactText,image_url:this.newImgUrl},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый факт успешно добавлен."}),this.icon=!1,this.getFacts(),this.newAuthor="",this.newFactName="",this.newFactText="",this.newImgUrl="",this.newFactFooter=""}catch(e){this.onError(e)}},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/fact/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getFacts()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/fact/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getFacts()}catch(a){this.onError(a)}}},computed:{getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows}}};var Sl=a(136),Ul=a(9420),Dl=a(7691);const Cl=(0,d.Z)(ql,[["render",xl],["__scopeId","data-v-7b46b51a"]]),El=Cl;E()(ql,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupEdit:Ya.Z,QFile:Ul.Z,QTooltip:Va.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QChip:Dl.Z,QItem:ee.Z,QCardActions:Ga.Z}),E()(ql,"directives",{ClosePopup:Ka.Z});const Tl=e=>((0,i.dD)("data-v-6ae4c6d4"),e=e(),(0,i.Cn)(),e),Ml={key:1},zl={class:"row"},Al={class:"col-auto"},Zl={class:"col-auto"},Nl={class:"col q-mt-sm"},jl=Tl((()=>(0,i._)("div",{class:"text-h6"},"Добавления нового мероприятия",-1))),Ll={class:"row items-center justify-end"},Ql={class:"row items-center justify-end"},Il={class:"row items-center justify-end"},Ol={class:"row items-center justify-end"},Pl={class:"col-auto q-mt-sm"},Hl={key:1},$l=Tl((()=>(0,i._)("br",null,null,-1))),Fl={class:"row items-center justify-end"},Bl={class:"row items-center justify-end"},Yl={class:"row items-center justify-end"},Rl={class:"row items-center justify-end"},Gl={key:2,class:"text-center"},Kl=Tl((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),Jl=Tl((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),Xl=[Kl,Jl],eo=Tl((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function to(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-date"),w=(0,i.up)("q-popup-proxy"),g=(0,i.up)("q-time"),f=(0,i.up)("q-checkbox"),y=(0,i.up)("q-card"),_=(0,i.up)("q-dialog"),b=(0,i.up)("q-spinner-dots"),v=(0,i.up)("q-card-actions"),V=(0,i.up)("q-separator"),k=(0,i.up)("q-th"),W=(0,i.up)("q-popup-edit"),x=(0,i.up)("q-td"),q=(0,i.up)("q-tooltip"),S=(0,i.up)("q-chip"),U=(0,i.up)("q-item"),D=(0,i.up)("q-tr"),C=(0,i.up)("q-table"),E=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Ml,[(0,i._)("div",zl,[(0,i._)("div",Al,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",Zl,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",Nl,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[14]||(t[14]=e=>l.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{modelValue:l.icon,"onUpdate:modelValue":t[13]||(t[13]=e=>l.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[jl,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[E]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newDateStart,"onUpdate:modelValue":t[5]||(t[5]=e=>o.newDateStart=e),label:"Дата начала"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"event",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.newDateStart,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newDateStart=e),mask:"DD.MM.YYYY, HH:mm:ss",minimal:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Ll,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:1},8,["modelValue","locale"])])),_:1})])),_:1})])),append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"access_time",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:o.newDateStart,"onUpdate:modelValue":t[4]||(t[4]=e=>o.newDateStart=e),mask:"DD.MM.YYYY, HH:mm:ss",format24h:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Ql,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:1},8,["modelValue","locale"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newDateEnd,"onUpdate:modelValue":t[8]||(t[8]=e=>o.newDateEnd=e),label:"Дата окончания"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"event",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.newDateEnd,"onUpdate:modelValue":t[6]||(t[6]=e=>o.newDateEnd=e),mask:"DD.MM.YYYY, HH:mm:ss",minimal:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Il,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:1},8,["modelValue","locale"])])),_:1})])),_:1})])),append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"access_time",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:o.newDateEnd,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newDateEnd=e),mask:"DD.MM.YYYY, HH:mm:ss",format24h:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Ol,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:1},8,["modelValue","locale"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(f,{modelValue:o.newIsFree,"onUpdate:modelValue":t[9]||(t[9]=e=>o.newIsFree=e),label:"Бесплатное",style:{opacity:"60%"}},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newOrganizName,"onUpdate:modelValue":t[10]||(t[10]=e=>o.newOrganizName=e),label:"Организатор"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newUrl,"onUpdate:modelValue":t[11]||(t[11]=e=>o.newUrl=e),label:"Адрес сайта"},null,8,["modelValue"]),(0,i.Wm)(m,{class:"q-mt-md",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[12]||(t[12]=e=>s.addNewEvent())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})]),(0,i._)("div",Pl,[(0,i.Wm)(m,{label:"Синхронизация данных",style:{color:"#616161"},flat:"","no-caps":"",icon:"download",onClick:t[15]||(t[15]=e=>o.sync=!0)}),(0,i.Wm)(_,{modelValue:o.sync,"onUpdate:modelValue":t[18]||(t[18]=e=>o.sync=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[o.syncprocess?((0,i.wg)(),(0,i.j4)(p,{key:0,style:{"text-align":"center"}},{default:(0,i.w5)((()=>[(0,i.Uk)(" К сожалению данный функционал находится в разработке "),(0,i._)("div",null,[(0,i.Wm)(b,{color:"primary",size:"2em"})])])),_:1})):((0,i.wg)(),(0,i.iD)("div",Hl,[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Вы уверены что хотите запустить синхронизацию? "),$l,(0,i.Uk)(" (внесенные изменения могут быть утеряны) ")])),_:1}),(0,i.Wm)(v,{align:"center"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{flat:"","no-caps":"",label:"Да",onClick:t[16]||(t[16]=e=>o.syncprocess=!0)}),(0,i.Wm)(m,{flat:"","no-caps":"",label:"Отмена",onClick:t[17]||(t[17]=e=>o.sync=!1)})])),_:1})]))])),_:1})])),_:1},8,["modelValue"])])]),(0,i.Wm)(V),(0,i.Wm)(C,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(D,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(x,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.name)),1),(0,i.Wm)(W,{modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,onHide:t=>s.changeName(e.row._id,e.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Название мероприятия"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"date_start",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.date_start),1),(0,i.Wm)(W,{modelValue:e.row.date_start,"onUpdate:modelValue":t=>e.row.date_start=t,onHide:t=>s.changeDateStart(e.row._id,e.row.date_start)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:e.row.date_start,"onUpdate:modelValue":t=>e.row.date_start=t},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"event",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:e.row.date_start,"onUpdate:modelValue":t=>e.row.date_start=t,mask:"DD.MM.YYYY, HH:mm:ss",minimal:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Fl,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:2},1032,["modelValue","onUpdate:modelValue","locale"])])),_:2},1024)])),_:2},1024)])),append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"access_time",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:e.row.date_start,"onUpdate:modelValue":t=>e.row.date_start=t,mask:"DD.MM.YYYY, HH:mm:ss",format24h:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Bl,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:2},1032,["modelValue","onUpdate:modelValue","locale"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"date_end",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.date_end),1),(0,i.Wm)(W,{modelValue:e.row.date_end,"onUpdate:modelValue":t=>e.row.date_end=t,onHide:t=>s.changeDateEnd(e.row._id,e.row.date_end)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:e.row.date_end,"onUpdate:modelValue":t=>e.row.date_end=t},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"event",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:e.row.date_end,"onUpdate:modelValue":t=>e.row.date_end=t,mask:"DD.MM.YYYY, HH:mm:ss",minimal:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Yl,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:2},1032,["modelValue","onUpdate:modelValue","locale"])])),_:2},1024)])),_:2},1024)])),append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"access_time",class:"cursor-pointer"},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:e.row.date_end,"onUpdate:modelValue":t=>e.row.date_end=t,mask:"DD.MM.YYYY, HH:mm:ss",format24h:"","first-day-of-week":"1",locale:o.localeCalend},{default:(0,i.w5)((()=>[(0,i._)("div",Rl,[(0,i.wy)((0,i.Wm)(m,{label:"Закрыть",color:"primary",flat:""},null,512),[[E]])])])),_:2},1032,["modelValue","onUpdate:modelValue","locale"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"isFree",props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{modelValue:e.row.isFree,"onUpdate:modelValue":t=>e.row.isFree=t,color:"grey-8",onClick:t=>s.changeIsFree(e.row._id,e.row.isFree)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"organization_name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.organization_name)),1),(0,i.Wm)(W,{modelValue:e.row.organization_name,"onUpdate:modelValue":t=>e.row.organization_name=t,onHide:t=>s.changeOrganizName(e.row._id,e.row.organization_name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.organization_name,"onUpdate:modelValue":t=>e.row.organization_name=t,label:"Организация"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"url",props:e},{default:(0,i.w5)((()=>[e.row.url?((0,i.wg)(),(0,i.j4)(m,{key:0,href:e.row.url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(q,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(e.row.url))+" ",1),(0,i.Wm)(W,{modelValue:e.row.url,"onUpdate:modelValue":t=>e.row.url=t,onHide:t=>s.changeUrl(e.row._id,e.row.url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.url,"onUpdate:modelValue":t=>e.row.url=t,label:"Ссылка на мероприятие"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"tags",props:e},{default:(0,i.w5)((()=>[e.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e.row.dir,(t=>((0,i.wg)(),(0,i.iD)("div",null,[t?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(t,(t=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(S,{removable:"",clickabl:"",onRemove:a=>s.delTag(e.row._id,t.id),style:(0,B.j5)({"background-color":`${t.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(t.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(m,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(W,{modelValue:o.model,"onUpdate:modelValue":t[20]||(t[20]=e=>o.model=e),onHide:t=>s.addNewTags(e.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[19]||(t[19]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(U,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(S,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"views",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.viewCount),1)])),_:2},1032,["props"]),(0,i.Wm)(x,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(q,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",Gl,Xl)):(0,i.kq)("",!0)]),(0,i.Wm)(_,{modelValue:o.confirm,"onUpdate:modelValue":t[22]||(t[22]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(y,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[eo])),_:1}),(0,i.Wm)(v,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[E]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[21]||(t[21]=e=>s.removeEvent(o.deleteRowId)),color:"primary"},null,512),[[E]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}const ao={setup(){return{icon:(0,s.iH)(!1)}},data(){return{deleteRowId:-1,sync:(0,s.iH)(!1),syncprocess:(0,s.iH)(!1),confirm:(0,s.iH)(!1),localeCalend:{monthsShort:["Янв.","Фев.","Мар.","Апр.","Май.","Июн.","Июл.","Авг.","Сен.","Окт.","Ноя.","Дек."],months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],daysShort:["Вс.","Пн.","Вт.","Ср.","Чт.","Пт.","Сб."],days:["Воскрксенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},newPass:"",text:"",searchSelected:"",roles:[],auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",trueFalseCond:[{value:!0,icon:"check_box",label:"Бесплатное"},{value:!1,icon:"check_box_outline_blank",label:"Платное"}],columns:[{name:"name",label:"Название",align:"left",field:"name",canEdit:!0,sortable:!0},{name:"date_start",label:"Дата начала",align:"left",field:"date_start",canEdit:!0,sortable:!0},{name:"date_end",align:"left",label:"Дата окончания",field:"date_end",canEdit:!0,sortable:!0},{name:"isFree",align:"center",label:"Бесплатно",canEdit:!0,sortable:!0},{name:"organization_name",align:"left",label:"Организаторы",field:"organization_name",canEdit:!0,sortable:!0},{name:"url",align:"left",label:"Адресс сайта",field:"url",canEdit:!0,sortable:!0},{name:"tags",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1},{name:"views",align:"left",label:"Просмотры",field:"viewCount",canEdit:!1,sortable:!0},{name:"control",align:"center",label:"Управление"}],rows:[],error:0,loaded:!1,newName:"",newDateStart:"",newDateEnd:"",newIsFree:!1,newOrganizName:"",newUrl:"",model:"",tags:[],tegid:""}},mounted(){this.getEvents(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async getTags(){try{const e=await b.api.get("api/childDir",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},async getEvents(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/event/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});await this.getTags(),e.data.forEach((e=>{e.date_end=this.formDateToUserView(e.date_end),e.date_start=this.formDateToUserView(e.date_start),e["viewCount"]=null!=e.views?Object.keys(e.views).length:0})),this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/event/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getEvents()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/event/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getEvents()}catch(a){this.onError(a)}},placeEventsToServer(){let e="https://opendata.mkrf.ru/v2/",t="https://graduate-map.ru/proxy/",a=1e3,l=["Москва","Московская область"],o=["cinema","circuses","concert_halls","culture_palaces_clubs","education","libraries","museums","parks","philharmonic","theaters"],s=new Date,i=String(s.getDate()).padStart(2,"0"),r=String(s.getMonth()+1).padStart(2,"0"),n=s.getFullYear();s=`${n}-${r}-${i}`;o.forEach((o=>{l.forEach((l=>{let i='$?f={"data.general.locale.name":{"$search":"'+l+'"}}&l='+a,r=t+e+o+"/"+i;const n=new XMLHttpRequest;n.open("GET",r,!0),n.setRequestHeader("X-API-KEY","9e78fe339dd2611d004c4b679f8f3bfc7dcc8ed7c5c5572ee4f45ae5752e8757"),n.setRequestHeader("x-requested-with","*"),n.onload=l=>{if(4===n.readyState&&200===n.status){let l=JSON.parse(n.responseText);l.data.forEach((l=>{let o=l.data.general.id,i=t+e+'events/$?f={"data.general.end":{"$gt":"'+s+'"},"data.general.organizerPlace.id":{"$eq":"'+o+'"}}&l='+a;const r=new XMLHttpRequest;r.open("GET",i,!0),r.setRequestHeader("X-API-KEY","9e78fe339dd2611d004c4b679f8f3bfc7dcc8ed7c5c5572ee4f45ae5752e8757"),r.setRequestHeader("x-requested-with","*"),r.onload=e=>{if(4===r.readyState&&200===r.status){let e=JSON.parse(r.responseText);e.data.forEach((async e=>{let t=e.data.general.id,a={name:e.data.general.name,description:e.data.general.description,isFree:e.data.general.isFree,date_start:e.data.general.start,date_end:e.data.general.end,organization_id:e.data.general.organization.id,organization_name:e.data.general.organization.name,api_id:t,image_url:e.data.general.image.url,url:void 0!==e.data.general.saleLink?e.data.general.saleLink:""};fetch("http://graduate-map.ru/api/event",{method:"POST",headers:{Authorization:"Basic "+btoa(auth),"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{console.log(e)}))}))}},r.send()}))}},n.send()}))}))},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async removeEvent(e){try{await b.api["delete"]("api/event/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.loaded=!0,this.$q.notify({type:"positive",message:"Событие удалено"}),this.getEvents()}catch(t){this.onError(t)}},async changeName(e,t){try{await b.api.put("api/event/"+e,{name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Название сохранено"})}catch(a){this.onError(a)}},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},formDateToUserView(e){let t=new Date(e).toLocaleString("ru-RU",{timeZone:"Europe/Moscow"});return t},formDateToDB(e){let t=e.split(","),a=t[0].split("."),l=t[1].split(":"),o=a[2]+"-"+a[1]+"-"+a[0]+"T"+(Number(l[0])-3).toString().padStart(2,"0")+":"+l[1]+":"+l[2]+".000Z";return o},async changeDateStart(e,t){let a=this.formDateToDB(t);try{await b.api.put("api/event/"+e,{date_start:a},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Дата начала сохранена"})}catch(l){this.onError(l)}},async changeDateEnd(e,t){this.formDateToDB(t);try{await b.api.put("api/event/"+e,{date_end:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Дата окончания сохранена"})}catch(a){this.onError(a)}},async changeIsFree(e,t){try{await b.api.put("api/event/"+e,{isFree:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Тип сохранен"})}catch(a){this.onError(a)}},async changeOrganizName(e,t){try{await b.api.put("api/event/"+e,{organization_name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Название организации сохранено"})}catch(a){this.onError(a)}},async changeUrl(e,t){try{await b.api.put("api/event/"+e,{url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка на мероприятие сохранена"})}catch(a){this.onError(a)}},async addNewEvent(){let e=this.formDateToDB(this.newDateStart),t=this.formDateToDB(this.newDateEnd);this.newName,this.newIsFree,this.newOrganizName,this.newUrl;try{await b.api.post("api/event",{name:this.newName,date_start:e,date_end:t,isFree:this.newIsFree,organization_name:this.newOrganizName,url:this.newUrl},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новое событие успешно добавлено."}),this.newName="",this.newDateStart="",this.newDateEnd="",this.isFree=!1,this.newOrganizName="",this.newUrl="",this.icon=!1,this.getEvents()}catch(a){this.onError(a)}}},computed:{getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows}}};var lo=a(2765),oo=a(4351),so=a(6770),io=a(1006),ro=a(7501);const no=(0,d.Z)(ao,[["render",to],["__scopeId","data-v-6ae4c6d4"]]),uo=no;E()(ao,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupProxy:lo.Z,QDate:oo.Z,QTime:so.Z,QCheckbox:io.Z,QSpinnerDots:ro.Z,QCardActions:Ga.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QPopupEdit:Ya.Z,QTooltip:Va.Z,QChip:Dl.Z,QItem:ee.Z}),E()(ao,"directives",{ClosePopup:Ka.Z});const co=e=>((0,i.dD)("data-v-26c7ed1a"),e=e(),(0,i.Cn)(),e),mo={key:1},po={class:"row"},ho={class:"col-auto"},wo={class:"col-auto"},go={class:"col q-mt-sm"},fo=co((()=>(0,i._)("div",{class:"text-h6"},"Добавления новой школы",-1))),yo=co((()=>(0,i._)("div",{id:"container"},null,-1))),_o={class:"col-auto q-mt-sm"},bo={key:1},vo=co((()=>(0,i._)("br",null,null,-1))),Vo=co((()=>(0,i._)("div",{class:"text-h6"},"Изменине координат школы",-1))),ko=co((()=>(0,i._)("div",{id:"map"},null,-1))),Wo={key:2,class:"text-center"},xo=co((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),qo=co((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),So=[xo,qo],Uo=co((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function Do(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-tooltip"),m=(0,i.up)("q-space"),p=(0,i.up)("q-btn"),h=(0,i.up)("q-card-section"),w=(0,i.up)("q-file"),g=(0,i.up)("q-popup-edit"),f=(0,i.up)("q-card"),y=(0,i.up)("q-dialog"),_=(0,i.up)("q-spinner-dots"),b=(0,i.up)("q-card-actions"),v=(0,i.up)("q-separator"),V=(0,i.up)("q-th"),k=(0,i.up)("q-td"),W=(0,i.up)("q-chip"),x=(0,i.up)("q-item"),q=(0,i.up)("q-tr"),S=(0,i.up)("q-table"),U=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",mo,[(0,i._)("div",po,[(0,i._)("div",ho,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",wo,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",go,[(0,i.Wm)(p,{flat:"",icon:"add",onClick:t[14]||(t[14]=e=>(o.icon=!0,s.showAddMap()))},{default:(0,i.w5)((()=>[(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить новую запись")])),_:1}),(0,i.Wm)(y,{modelValue:o.icon,"onUpdate:modelValue":t[13]||(t[13]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[fo,(0,i.Wm)(m),(0,i.wy)((0,i.Wm)(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])])),_:1}),(0,i.Wm)(h,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newDescription,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newDescription=e),label:"Описание"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newSchoolImg,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newSchoolImg=e),label:"Ссылка на изображение школы"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(g,{modelValue:o.file_1,"onUpdate:modelValue":t[6]||(t[6]=e=>o.file_1=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:o.file,"onUpdate:modelValue":[t[4]||(t[4]=e=>o.file=e),t[5]||(t[5]=e=>s.uploadFileA())],label:"Выберете изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(d,{modelValue:l.newShoolAddressName,"onUpdate:modelValue":t[8]||(t[8]=e=>l.newShoolAddressName=e),label:"Адресс школы",readonly:""},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newAddressComment,"onUpdate:modelValue":t[9]||(t[9]=e=>o.newAddressComment=e),label:"Комментарий адреса"},null,8,["modelValue"]),yo,(0,i.Wm)(d,{modelValue:o.newWebSite,"onUpdate:modelValue":t[10]||(t[10]=e=>o.newWebSite=e),label:"Адрес сайта"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newMail,"onUpdate:modelValue":t[11]||(t[11]=e=>o.newMail=e),label:"Электронная почта школы"},null,8,["modelValue"]),(0,i.Wm)(p,{class:"q-mt-md",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},flat:"",onClick:t[12]||(t[12]=e=>s.addNewSchool())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})]),(0,i._)("div",_o,[(0,i.Wm)(p,{label:"Синхронизация данных",style:{color:"#616161"},flat:"","no-caps":"",icon:"download",onClick:t[15]||(t[15]=e=>o.sync=!0)}),(0,i.Wm)(y,{persistent:"",modelValue:o.sync,"onUpdate:modelValue":t[18]||(t[18]=e=>o.sync=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[o.syncprocess?((0,i.wg)(),(0,i.j4)(h,{key:0,persistent:"",style:{"text-align":"center"}},{default:(0,i.w5)((()=>[(0,i.Uk)(" Идет синхронизация данных "),(0,i._)("div",null,[(0,i.Wm)(_,{color:"primary",size:"2em"})])])),_:1})):((0,i.wg)(),(0,i.iD)("div",bo,[(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Вы уверены что хотите запустить синхронизацию? "),vo,(0,i.Uk)(" (внесенные изменения могут быть утеряны) ")])),_:1}),(0,i.Wm)(b,{align:"center"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{flat:"","no-caps":"",label:"Да",onClick:t[16]||(t[16]=e=>(s.getSchoolOpenData(),o.syncprocess=!0))}),(0,i.Wm)(p,{flat:"","no-caps":"",label:"Отмена",onClick:t[17]||(t[17]=e=>o.sync=!1)})])),_:1})]))])),_:1})])),_:1},8,["modelValue"])])]),(0,i.Wm)(v),(0,i.Wm)(S,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(V,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(q,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.name)),1),(0,i.Wm)(g,{modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,onHide:t=>s.changeName(e.row._id,e.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Название школы"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"description",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.description)),1),(0,i.Wm)(g,{modelValue:e.row.description,"onUpdate:modelValue":t=>e.row.description=t,onHide:t=>s.changeDescription(e.row._id,e.row.description)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.description,"onUpdate:modelValue":t=>e.row.description=t,label:"Название школы"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"shool_image",props:e},{default:(0,i.w5)((()=>[e.row.image_url?((0,i.wg)(),(0,i.j4)(p,{key:0,href:e.row.image_url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(e.row.image_url))+" ",1),(0,i.Wm)(p,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(g,{modelValue:o.file_2,"onUpdate:modelValue":t[20]||(t[20]=e=>o.file_2=e),onHide:t=>s.changeSchoolImage(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{modelValue:o.file,"onUpdate:modelValue":[t[19]||(t[19]=e=>o.file=e),t=>s.uploadFileB(e.row._id)],label:"Выберете изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onHide"]),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:2},1024),(0,i.Wm)(g,{modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,onHide:t=>s.changeSchoolImage(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,label:"Ссылка на изображение школы"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"address_str",props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{flat:"",dense:"",color:"grey-8",onClick:t=>(o.iconn=!0,o.idMap=e.row._id,o.curMapAdressAdress=e.row.address)},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"map"}),(0,i.Uk)(),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)(" Координаты ")])),_:1})])),_:2},1032,["onClick"]),(0,i.Uk)(" "+(0,B.zw)(e.row.address.address_str),1)])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"address_comment",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.address.comment)),1),(0,i.Wm)(g,{modelValue:e.row.address.comment,"onUpdate:modelValue":t=>e.row.address.comment=t,onHide:t=>s.changeAddress(e.row._id,e.row.address)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.address.comment,"onUpdate:modelValue":t=>e.row.address.comment=t,label:"Комментарий к адресу"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"web_site",props:e},{default:(0,i.w5)((()=>[e.row.contacts.web_site?((0,i.wg)(),(0,i.j4)(p,{key:0,href:e.row.contacts.web_site,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.row.contacts.web_site)+" ",1),(0,i.Wm)(g,{modelValue:e.row.contacts.web_site,"onUpdate:modelValue":t=>e.row.contacts.web_site=t,onHide:t=>s.changeContact(e.row._id,e.row.contacts)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.contacts.web_site,"onUpdate:modelValue":t=>e.row.contacts.web_site=t,label:"Веб сайт"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"mail",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.contacts.mail),1),(0,i.Wm)(g,{modelValue:e.row.contacts.mail,"onUpdate:modelValue":t=>e.row.contacts.mail=t,onHide:t=>s.changeContact(e.row._id,e.row.contacts)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.contacts.mail,"onUpdate:modelValue":t=>e.row.contacts.mail=t,label:"Адресс электронной почты"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"tags",props:e},{default:(0,i.w5)((()=>[e.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e.row.dir,(t=>((0,i.wg)(),(0,i.iD)("div",null,[t?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(t,(t=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(W,{removable:"",clickabl:"",onRemove:a=>s.delTag(e.row._id,t.id),style:(0,B.j5)({"background-color":`${t.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(t.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(p,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(g,{modelValue:o.model,"onUpdate:modelValue":t[22]||(t[22]=e=>o.model=e),onHide:t=>s.addNewTags(e.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[21]||(t[21]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(x,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(W,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"views",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.viewCount),1)])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(c,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),(0,i.Wm)(y,{onShow:t[24]||(t[24]=e=>s.mapOpen()),modelValue:o.iconn,"onUpdate:modelValue":t[25]||(t[25]=e=>o.iconn=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[Vo,(0,i.Wm)(m),(0,i.wy)((0,i.Wm)(p,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[ko,(0,i.Wm)(p,{onClick:t[23]||(t[23]=e=>s.changeCoordinate()),flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"}},{default:(0,i.w5)((()=>[(0,i.Uk)(" Принять")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),403==o.error?((0,i.wg)(),(0,i.iD)("div",Wo,So)):(0,i.kq)("",!0),(0,i.Wm)(y,{modelValue:o.confirm,"onUpdate:modelValue":t[27]||(t[27]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{class:"row items-center"},{default:(0,i.w5)((()=>[Uo])),_:1}),(0,i.Wm)(b,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(p,{flat:"",label:"Отмена",color:"primary"},null,512),[[U]]),(0,i.wy)((0,i.Wm)(p,{flat:"",label:"Удалить",onClick:t[26]||(t[26]=e=>s.removeSchool(o.deleteRowId)),color:"primary"},null,512),[[U]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var Co=a(1728),Eo=a(7524);const To={setup(){return{newShoolAddressName:(0,s.iH)(""),alert:(0,s.iH)(!1)}},data(){return{file_1:null,file_2:null,file:(0,s.iH)(null),deleteRowId:-1,confirm:(0,s.iH)(!1),sync:(0,s.iH)(!1),syncprocess:(0,s.iH)(!1),iconn:(0,s.iH)(!1),icon:(0,s.iH)(!1),iconTegs:(0,s.iH)(!1),newPass:"",text:"",roles:[],searchSelected:"",columns:[{name:"name",label:"Название",align:"left",field:"name",canEdit:!0,sortable:!0},{name:"description",label:"Описание",align:"left",field:"description",canEdit:!0,sortable:!0},{name:"shool_image",label:"Ссылка на изображение школы",align:"left",field:"image_url",canEdit:!0,sortable:!0},{name:"address_str",align:"left",label:"Адресс школы",field:"address.address_str",canEdit:!1,sortable:!0},{name:"address_comment",align:"left",label:"Комментарий к адресу",field:"address.comment",canEdit:!0,sortable:!0},{name:"web_site",align:"left",label:"Сайт школы",field:"contacts.web_site",canEdit:!0,sortable:!0},{name:"mail",align:"left",label:"Адресс электронной почты",field:"contacts.mail",canEdit:!0,sortable:!0},{name:"tags",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1},{name:"views",align:"left",label:"Просмотры",field:"viewCount",canEdit:!1,sortable:!0},{name:"control",align:"left",label:"Управление"}],rows:[],tegs:[],colorTeg:[],error:0,loaded:!1,password:(0,s.iH)(""),isPwd:(0,s.iH)(!0),auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",newName:"",newDescription:"",newSchoolImg:"",newAddressStr:"",newAddressComment:"",newWebSite:"",newMail:"",x:0,y:0,xMarkerMap:0,yMarkerMap:0,curMapAdressAdress:{},idMap:"",tags:[],model:"",factTegId:"",schoolDataArr:(0,s.iH)([])}},mounted(){this.getSchool(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async uploadFileB(e){if(null==this.file)return;let t=new FormData;t.append("file",this.file);try{const a=await b.api.post("api/uploads/create/",t,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows.forEach((t=>{t._id==e&&(t.image_url=a.data)})),this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(a){this.onError(a)}},async uploadFileA(){if(null==this.file)return;let e=new FormData;e.append("file",this.file);try{const t=await b.api.post("api/uploads/create/",e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.newSchoolImg=t.data,this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(t){this.onError(t)}},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},async getTags(){try{const e=await b.api.get("api/childDir",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},async getSchool(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/school/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});await this.getTags(),e.data.forEach((e=>{e["viewCount"]=null!=e.views?Object.keys(e.views).length:0})),this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},cutTegs(e){var t=/( |<([^>]+)>)/gi,a=e.replace(t," ");return a=a.replace("&nbsp;"," "),a},async getSchoolOpenData(){let e='https://opendata.mkrf.ru/v2/education/$?f={"data.general.locale.name":{"$contain":"моск"}}&l=1000',t="https://graduate-map.ru/proxy/",a=t+e;Eo.Z.get(a,{headers:{"X-API-KEY":"9e78fe339dd2611d004c4b679f8f3bfc7dcc8ed7c5c5572ee4f45ae5752e8757","x-requested-with":"*"}}).then((async e=>{this.schoolDataArr=e.data.data;let t=1;for(const a of this.schoolDataArr){let e={address_str:a.data.general.address.street,comment:a.data.general.address.comment,mapPos:{x:a.data.general.address.mapPosition.coordinates[0],y:a.data.general.address.mapPosition.coordinates[1]}},l=null;void 0!==a.data.general.contacts&&(l={web_site:a.data.general.contacts.website??"",mail:a.data.general.contacts.email??"",phone:a.data.general.contacts.phones??[]});let o={organization_id:a.data.general.id,image_url:a.data.general.image.url,name:a.data.general.name,description:a.data.general.description?this.cutTegs(a.data.general.description):"",address:e,contacts:l};await b.api.post("api/school",o,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});t==this.schoolDataArr.length&&(this.sync=!1,this.syncprocess=!1,this.$q.notify({type:"positive",message:"Синхронизация завершена!"}),this.getSchool()),t++}})).catch((e=>{console.error(e)}))},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/school/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getSchool()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/school/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getSchool()}catch(a){this.onError(a)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async removeSchool(e){try{await b.api["delete"]("api/school/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.loaded=!0,this.$q.notify({type:"positive",message:"Школа удалена"}),this.getSchool()}catch(t){this.onError(t)}},async changeName(e,t){try{await b.api.put("api/school/"+e,{name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Имя школы сохранено"})}catch(a){this.onError(a)}},async changeDescription(e,t){try{await b.api.put("api/school/"+e,{description:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Описание школы сохранено"})}catch(a){this.onError(a)}},async changeSchoolImage(e,t){try{await b.api.put("api/school/"+e,{image_url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка на изображение сохранена"})}catch(a){this.onError(a)}},async changeAddress(e,t){try{await b.api.put("api/school/"+e,{address:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Адрес сохранен"})}catch(a){this.onError(a)}},async changeContact(e,t){try{await b.api.put("api/school/"+e,{contacts:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка на веб-ресурс сохранена"})}catch(a){this.onError(a)}},async showAddMap(){const e=await(0,Co.z)(),t=new e.Map("container",{center:[37.62199313139937,55.754172570006155],zoom:15,key:"042b5b75-f847-4f2a-b695-b5f58adc9dfd"});let a,l=null;t.on("click",(o=>{if(!o.target)return;const{id:s}=o.target;null==l?(l=s,a=new e.Marker(t,{coordinates:[o.lngLat[0],o.lngLat[1]]})):(l=s,a.destroy(),a=new e.Marker(t,{coordinates:[o.lngLat[0],o.lngLat[1]]})),this.x=o.lngLat[0],this.y=o.lngLat[1],this.getNewSchoolName(),t.setSelectedObjects([l])}))},getNewSchoolName(){const e="rujnfh1727",t=`https://catalog.api.2gis.com/3.0/items/geocode?lon=${this.x}&lat=${this.y}&type=building&key=${e}`,a=new XMLHttpRequest;a.open("GET",t),a.onload=()=>{if(200===a.status){const e=JSON.parse(a.responseText);this.newShoolAddressName=e.result.items[0].address_name}},a.send()},async addNewSchool(){if(""!=this.newShoolAddressName&&-1!=this.x&&-1!=this.y)try{b.api.post("api/school",{name:this.newName,description:this.newDescription,image_url:this.newSchoolImg,address:{address_str:this.newShoolAddressName,comment:this.newAddressComment,mapPos:{x:this.x,y:this.y}},contacts:{mail:this.newMail,web_site:this.newWebSite}},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новое соьбытие успешно добавлен."}),this.newName="",this.newDescription="",this.newSchoolImg="",this.newShoolAddressName="",this.newAddressComment="",this.newWebSite="",this.newMail="",this.icon=!1,this.getSchool()}catch(e){this.onError(e)}else this.$q.notify({type:"negative",message:"Ошибка не все поля заполнены"})},getNewAddSchoolName(){const e="rupzho5301",t=`https://catalog.api.2gis.com/3.0/items/geocode?lon=${this.curMapAdressAdress.mapPos.x}&lat=${this.curMapAdressAdress.mapPos.y}&type=building&key=${e}`,a=new XMLHttpRequest;a.open("GET",t),a.onload=()=>{if(200===a.status){const e=JSON.parse(a.responseText);this.curMapAdressAdress.address_str=e.result.items[0].address_name}},a.send()},async changeCoordinate(){this.getNewAddSchoolName(),setTimeout((()=>{try{b.api.put("api/school/"+this.idMap,{address:this.curMapAdressAdress},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Координаты школы успешно обновлены"}),this.iconn=!1,this.getSchool()}catch(e){this.onError(e)}}),"2000")},async mapOpen(){const e=await(0,Co.z)(),t=new e.Map("map",{center:[this.curMapAdressAdress.mapPos.x,this.curMapAdressAdress.mapPos.y],zoom:18,key:"042b5b75-f847-4f2a-b695-b5f58adc9dfd"}),a=new e.Marker(t,{coordinates:[this.curMapAdressAdress.mapPos.x,this.curMapAdressAdress.mapPos.y]});let l,o=null;t.on("click",(e=>{if(!e.target)return;const{id:s}=e.target;null==o?(o=s,l=new mapgl.Marker(t,{coordinates:[e.lngLat[0],e.lngLat[1]]}),a.destroy()):(o=s,l.destroy(),l=new mapgl.Marker(t,{coordinates:[e.lngLat[0],e.lngLat[1]]})),this.curMapAdressAdress.mapPos.x=e.lngLat[0],this.curMapAdressAdress.mapPos.y=e.lngLat[1],t.setSelectedObjects([o])}))}},computed:{getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows}}},Mo=(0,d.Z)(To,[["render",Do],["__scopeId","data-v-26c7ed1a"]]),zo=Mo;E()(To,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QTooltip:Va.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupEdit:Ya.Z,QFile:Ul.Z,QSpinnerDots:ro.Z,QCardActions:Ga.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QChip:Dl.Z,QItem:ee.Z}),E()(To,"directives",{ClosePopup:Ka.Z});const Ao=e=>((0,i.dD)("data-v-2969ce14"),e=e(),(0,i.Cn)(),e),Zo={key:1},No={class:"row"},jo={class:"col-auto"},Lo={class:"col-auto"},Qo={class:"col q-mt-sm"},Io=Ao((()=>(0,i._)("div",{class:"text-h6"},"Добавление новой новости",-1))),Oo={key:2,class:"text-center"},Po=Ao((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),Ho=Ao((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),$o=[Po,Ho],Fo=Ao((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function Bo(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-file"),w=(0,i.up)("q-popup-edit"),g=(0,i.up)("q-tooltip"),f=(0,i.up)("q-card"),y=(0,i.up)("q-dialog"),_=(0,i.up)("q-separator"),b=(0,i.up)("q-th"),v=(0,i.up)("q-td"),V=(0,i.up)("q-chip"),k=(0,i.up)("q-item"),W=(0,i.up)("q-tr"),x=(0,i.up)("q-table"),q=(0,i.up)("q-card-actions"),S=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Zo,[(0,i._)("div",No,[(0,i._)("div",jo,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.textSearch,"onUpdate:modelValue":t[0]||(t[0]=e=>o.textSearch=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",Lo,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",Qo,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[10]||(t[10]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(y,{modelValue:o.icon,"onUpdate:modelValue":t[9]||(t[9]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[Io,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newTitle,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newTitle=e),label:"Заголовок"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newText,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newText=e),label:"Текст"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newImgUrl,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newImgUrl=e),label:"Ссылка на изображение"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_1,"onUpdate:modelValue":t[6]||(t[6]=e=>o.file_1=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[4]||(t[4]=e=>o.file=e),t[5]||(t[5]=e=>s.uploadFileA())],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(m,{class:"q-mt-md",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[8]||(t[8]=e=>s.addNewNews())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(_),(0,i.Wm)(x,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(b,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(W,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{key:"title",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.title)),1),(0,i.Wm)(w,{modelValue:e.row.title,"onUpdate:modelValue":t=>e.row.title=t,onHide:t=>s.changeTitle(e.row._id,e.row.title)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.title,"onUpdate:modelValue":t=>e.row.title=t,label:"Заголовок"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"text",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(s.getShortText(e.row.text)),1),(0,i.Wm)(w,{modelValue:e.row.text,"onUpdate:modelValue":t=>e.row.text=t,onHide:t=>s.changeDescription(e.row._id,e.row.text)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.text,"onUpdate:modelValue":t=>e.row.text=t,label:"Текст"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"image_url",props:e},{default:(0,i.w5)((()=>[e.row.image_url?((0,i.wg)(),(0,i.j4)(m,{key:0,href:e.row.image_url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(e.row.image_url))+" ",1),(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_2,"onUpdate:modelValue":t[12]||(t[12]=e=>o.file_2=e),onHide:t=>s.changeUrl(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[11]||(t[11]=e=>o.file=e),t=>s.uploadFileB(e.row._id)],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onHide"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:2},1024),(0,i.Wm)(w,{modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,onHide:t=>s.changeUrl(e.row._id,e.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.image_url,"onUpdate:modelValue":t=>e.row.image_url=t,label:"Ссылка на изображение"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"tags",props:e},{default:(0,i.w5)((()=>[e.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e.row.dir,(t=>((0,i.wg)(),(0,i.iD)("div",null,[t?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(t,(t=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(V,{removable:"",clickabl:"",onRemove:a=>s.delTag(e.row._id,t.id),style:(0,B.j5)({"background-color":`${t.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(t.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(m,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(w,{modelValue:o.model,"onUpdate:modelValue":t[14]||(t[14]=e=>o.model=e),onHide:t=>s.addNewTags(e.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[13]||(t[13]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(k,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(V,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"views",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.viewCount),1)])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"like",props:e},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.likeCount),1)])),_:2},1032,["props"]),(0,i.Wm)(v,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",Oo,$o)):(0,i.kq)("",!0),(0,i.Wm)(y,{modelValue:o.confirm,"onUpdate:modelValue":t[16]||(t[16]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[Fo])),_:1}),(0,i.Wm)(q,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[S]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[15]||(t[15]=e=>s.removeNews(o.deleteRowId)),color:"primary"},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}const Yo={data(){return{file_1:null,file_2:null,file:(0,s.iH)(null),deleteRowId:-1,icon:(0,s.iH)(!1),newPass:"",textSearch:"",confirm:(0,s.iH)(!1),searchSelected:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",columns:[{name:"title",label:"Заголовок",align:"left",field:"title",canEdit:!0,sortable:!0},{name:"text",align:"left",label:"Текст",field:"text",canEdit:!0,sortable:!0},{name:"image_url",align:"left",label:"Ссылка на изображение",field:"image_url",canEdit:!0,sortable:!0},{name:"tags",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1},{name:"control",align:"left",label:"Управление"}],rows:[],error:0,loaded:!1,newTitle:"",newText:"",newImgUrl:"",tags:[],model:"",factTegId:""}},mounted(){this.getNews(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async getTags(){try{const e=await b.api.get("api/childDir",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},async uploadFileB(e){if(null==this.file)return;let t=new FormData;t.append("file",this.file);try{const a=await b.api.post("api/uploads/create/",t,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows.forEach((t=>{t._id==e&&(t.image_url=a.data)})),this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(a){this.onError(a)}},async uploadFileA(){if(null==this.file)return;let e=new FormData;e.append("file",this.file);try{const t=await b.api.post("api/uploads/create/",e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.newImgUrl=t.data,this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(t){this.onError(t)}},async getNews(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/news/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});await this.getTags(),e.data.forEach((e=>{let t=0;null!=e.views&&Object.values(e.views).forEach((e=>{e.like&&t++})),e["likeCount"]=t,e["viewCount"]=e.views?Object.values(e.views).length:0})),this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async removeNews(e){try{await b.api["delete"]("api/news/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.loaded=!0,this.$q.notify({type:"positive",message:"Новость удалена"}),this.getNews()}catch(t){this.onError(t)}},async changeTitle(e,t){try{await b.api.put("api/news/"+e,{title:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Заголовок сохранен"})}catch(a){this.onError(a)}},async changeDescription(e,t){try{await b.api.put("api/news/"+e,{text:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Текст сохранен"})}catch(a){this.onError(a)}},async changeUrl(e,t){try{await b.api.put("api/news/"+e,{image_url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка сохранена"})}catch(a){this.onError(a)}},async addNewNews(){try{await b.api.post("api/news",{title:this.newTitle,text:this.newText,image_url:this.newImgUrl},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новость успешно добавлена."}),this.icon=!1,this.getNews(),this.newTitle="",this.newText="",this.newImgUrl=""}catch(e){this.onError(e)}},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/news/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getNews()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/news/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getNews()}catch(a){this.onError(a)}}},computed:{getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getRows(){if(""!==this.textSearch){let e,t=this.textSearch,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows}}},Ro=(0,d.Z)(Yo,[["render",Bo],["__scopeId","data-v-2969ce14"]]),Go=Ro;E()(Yo,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupEdit:Ya.Z,QFile:Ul.Z,QTooltip:Va.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QChip:Dl.Z,QItem:ee.Z,QCardActions:Ga.Z}),E()(Yo,"directives",{ClosePopup:Ka.Z});const Ko=e=>((0,i.dD)("data-v-70b5b4ad"),e=e(),(0,i.Cn)(),e),Jo={key:1},Xo=Ko((()=>(0,i._)("div",{class:"text-h6"},"Родительские теги",-1))),es={class:"row"},ts={class:"col-auto"},as={class:"col-auto"},ls={class:"col q-mt-sm"},os=Ko((()=>(0,i._)("div",{class:"text-h6"},"Добавления нового тега",-1))),ss={key:2,class:"text-center"},is=Ko((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),rs=Ko((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),ns=[is,rs],ds=Ko((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1))),us={key:1},cs=Ko((()=>(0,i._)("div",{class:"text-h6"},"Дочерние теги",-1))),ms={class:"row"},ps={class:"col-3"},hs={class:"col-2"},ws={class:"col-1 q-mt-sm"},gs=Ko((()=>(0,i._)("div",{class:"text-h6"},"Добавления нового тега",-1))),fs={key:2,class:"text-center"},ys=Ko((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),_s=Ko((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),bs=[ys,_s],vs=Ko((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function Vs(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-color"),w=(0,i.up)("q-card"),g=(0,i.up)("q-dialog"),f=(0,i.up)("q-separator"),y=(0,i.up)("q-th"),_=(0,i.up)("q-popup-edit"),b=(0,i.up)("q-td"),v=(0,i.up)("q-chip"),V=(0,i.up)("q-tooltip"),k=(0,i.up)("q-tr"),W=(0,i.up)("q-table"),x=(0,i.up)("q-card-actions"),q=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Jo,[Xo,(0,i._)("div",es,[(0,i._)("div",ts,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",as,[(0,i.Wm)(u,{borderless:"",modelValue:o.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>o.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",ls,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[6]||(t[6]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:o.icon,"onUpdate:modelValue":t[5]||(t[5]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[os,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(h,{modelValue:o.newColor,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newColor=e),"no-header-tabs":"","no-footer":""},null,8,["modelValue"]),(0,i.Wm)(m,{class:"q-mt-lg",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[4]||(t[4]=e=>s.addTag())},{default:(0,i.w5)((()=>[(0,i.Uk)("Принять")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(f),(0,i.Wm)(W,{"rows-per-page-options":[0],flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(y,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.name),1),(0,i.Wm)(_,{modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,onHide:t=>s.changeTagName(e.row._id,e.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Название тега"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"color",props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:(0,B.j5)([{"background-color":`${e.row.color}`},{"font-size":"16px"}]),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.name)+" ",1),(0,i.Wm)(_,{modelValue:e.row.color,"onUpdate:modelValue":t=>e.row.color=t,onHide:t=>s.changeTagColor(e.row._id,e.row.color)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:e.row.color,"onUpdate:modelValue":t=>e.row.color=t,"no-header-tabs":"","no-footer":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["style"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(V,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",ss,ns)):(0,i.kq)("",!0),(0,i.Wm)(g,{modelValue:o.confirm,"onUpdate:modelValue":t[8]||(t[8]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[ds])),_:1}),(0,i.Wm)(x,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[q]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[7]||(t[7]=e=>s.deleteTag(o.deleteRowId)),color:"primary"},null,512),[[q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",us,[cs,(0,i._)("div",ms,[(0,i._)("div",ps,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.textCh,"onUpdate:modelValue":t[9]||(t[9]=e=>o.textCh=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",hs,[(0,i.Wm)(u,{borderless:"",modelValue:o.searchSelected,"onUpdate:modelValue":t[10]||(t[10]=e=>o.searchSelected=e),options:s.getSearchParamsArrayCh},null,8,["modelValue","options"])]),(0,i._)("div",ws,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[15]||(t[15]=e=>o.iconCh=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:o.iconCh,"onUpdate:modelValue":t[14]||(t[14]=e=>o.iconCh=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[gs,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newChildName,"onUpdate:modelValue":t[11]||(t[11]=e=>o.newChildName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(u,{modelValue:o.newChildParentId,"onUpdate:modelValue":t[12]||(t[12]=e=>o.newChildParentId=e),"emit-value":"","map-options":"",options:s.getParentSelectOptions},null,8,["modelValue","options"]),(0,i.Wm)(m,{class:"q-mt-lg",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[13]||(t[13]=e=>s.addChildTag())},{default:(0,i.w5)((()=>[(0,i.Uk)("Принять")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(f),(0,i.Wm)(W,{"rows-per-page-options":[0],flat:"",borderless:"",separator:"cell",rows:s.getRowsCh,columns:o.columnsCh,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(y,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.name),1),(0,i.Wm)(_,{modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,onHide:t=>s.changeChildDirName(e.row._id,e.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Название тега"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"parent",props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:(0,B.j5)([{"background-color":`${e.row.color}`},{"font-size":"16px"}]),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.name)+" ",1),(0,i.Wm)(_,{modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,onHide:t=>s.changeChildDirParent(e.row._id,e.row.parent)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:e.row.parent,"onUpdate:modelValue":t=>e.row.parent=t,"emit-value":"","map-options":"",options:s.getParentSelectOptions},null,8,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["style"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirmCh=!0,o.deleteRowIdCh=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(V,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",fs,bs)):(0,i.kq)("",!0),(0,i.Wm)(g,{modelValue:o.confirmCh,"onUpdate:modelValue":t[17]||(t[17]=e=>o.confirmCh=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[vs])),_:1}),(0,i.Wm)(x,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[q]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[16]||(t[16]=e=>s.removeChildDir(o.deleteRowIdCh)),color:"primary"},null,512),[[q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])])}const ks={data(){return{deleteRowId:-1,pagination:(0,s.iH)(null),deleteRowIdCh:-1,confirm:(0,s.iH)(!1),confirmCh:(0,s.iH)(!1),icon:(0,s.iH)(!1),iconCh:(0,s.iH)(!1),newColor:"#000000",newName:"",newChildName:"",newChildParent:"",newChildParentId:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",text:"",textCh:"",searchSelected:"",searchSelectedCh:"",columns:[{name:"name",align:"left",label:"Название",field:"name",canEdit:!0,sortable:!0},{name:"color",align:"left",label:"Цвет",canEdit:!0,sortable:!1},{name:"control",align:"left",label:"Управление"}],columnsCh:[{name:"name",align:"left",label:"Название",field:"name",canEdit:!0,sortable:!0},{name:"parent",align:"left",label:"Тег верхнего уровня",canEdit:!0,sortable:!1},{name:"control",align:"left",label:"Управление"}],rows:[],rowsCh:[],error:0,loaded:!1}},mounted(){this.getTegs(),this.getChildTag(),this.searchSelectedCh=this.getSearchParamsArrayCh[0],this.searchSelected=this.getSearchParamsArray[0]},methods:{async getChildTag(){try{const e=await b.api.get("api/childDir/",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rowsCh=e.data}catch(e){this.onError(e)}},async addChildTag(){if(""!=this.newChildParentId||""!=this.newChildName)try{await b.api.post("api/childDir/",{name:this.newChildName,parent:this.newChildParentId},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег добавлен"}),this.newChildName="",this.newChildParent="",this.newChildParentId="",this.getChildTag(),this.iconCh=!1}catch(e){this.onError(e)}else this.$q.notify({type:"negative",message:"Не все поля заполнены"})},async removeChildDir(e){try{await b.api["delete"]("api/childDir/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег удален"}),this.getChildTag()}catch(t){this.onError(t)}},async changeChildDirName(e,t){try{await b.api.put("api/childDir/"+e,{name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег сохранен"}),this.getChildTag()}catch(a){this.onError(a)}},async changeChildDirParent(e,t){if(""!=t)try{await b.api.put("api/childDir/"+e,{parent:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег сохранен"}),this.getChildTag()}catch(a){this.onError(a)}},async getTegs(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/direction",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},async changeTagName(e,t){try{await b.api.put("api/direction/"+e,{name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Название сохранено"}),this.getTegs(),this.getChildTag()}catch(a){this.onError(a)}},async changeTagColor(e,t){try{await b.api.put("api/direction/"+e,{color:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Цвет сохранен"}),this.getTegs(),this.getChildTag()}catch(a){this.onError(a)}},async addTag(){try{await b.api.post("api/direction",{name:this.newName,color:this.newColor},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег добавлен"}),this.icon=!1,this.newColor="#000000",this.newName="",this.getTegs()}catch(e){this.onError(e)}},async deleteTag(e){console.log(e);try{await b.api["delete"]("api/direction/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег удален"}),this.getTegs()}catch(t){this.onError(t)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})}},computed:{getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getRowsCh(){if(""!==this.textCh){let e,t=this.textCh,a=[];this.columnsCh.forEach((t=>{t.label==this.searchSelectedCh&&(e=t.field)}));let l=e.split(".");return this.rowsCh.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rowsCh},getSearchParamsArrayCh(){let e=[];return this.columnsCh.forEach((t=>{t.field&&e.push(t.label)})),e},getParentSelectOptions(){let e=[];return this.rows.forEach((t=>{e.push({label:t.name,value:t._id})})),e}}};var Ws=a(7606);const xs=(0,d.Z)(ks,[["render",Vs],["__scopeId","data-v-70b5b4ad"]]),qs=xs;E()(ks,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QColor:Ws.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QPopupEdit:Ya.Z,QChip:Dl.Z,QTooltip:Va.Z,QCardActions:Ga.Z}),E()(ks,"directives",{ClosePopup:Ka.Z});const Ss=e=>((0,i.dD)("data-v-673e56fe"),e=e(),(0,i.Cn)(),e),Us={key:1},Ds={class:"row"},Cs={class:"col-auto"},Es={class:"col-auto"},Ts={class:"col q-mt-sm"},Ms=Ss((()=>(0,i._)("div",{class:"text-h6"},"Добавление курса",-1))),zs={key:2,class:"text-center"},As=Ss((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),Zs=Ss((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),Ns=[As,Zs],js=Ss((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1))),Ls=Ss((()=>(0,i._)("div",{class:"text-h5"},"Редактор курса",-1))),Qs={class:"row"},Is={class:"row justify-between"},Os={class:"col-8 text-h6",style:{color:"gray"}},Ps={class:"col-1"},Hs=["src"];function $s(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-file"),w=(0,i.up)("q-popup-edit"),g=(0,i.up)("q-tooltip"),f=(0,i.up)("q-checkbox"),y=(0,i.up)("q-chip"),_=(0,i.up)("q-item"),b=(0,i.up)("q-card"),v=(0,i.up)("q-dialog"),V=(0,i.up)("q-separator"),k=(0,i.up)("q-th"),W=(0,i.up)("q-td"),x=(0,i.up)("q-tr"),q=(0,i.up)("q-table"),S=(0,i.up)("q-card-actions"),U=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Us,[(0,i._)("div",Ds,[(0,i._)("div",Cs,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",Es,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",Ts,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[13]||(t[13]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{modelValue:o.icon,"onUpdate:modelValue":t[12]||(t[12]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[Ms,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[U]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newTitle,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newTitle=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newText,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newText=e),label:"Описание"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newImage_url,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newImage_url=e),label:"Ссылка на титульное изображение"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_1,"onUpdate:modelValue":t[6]||(t[6]=e=>o.file_1=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[4]||(t[4]=e=>o.file=e),t[5]||(t[5]=e=>s.uploadFileA())],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newAuthor,"onUpdate:modelValue":t[8]||(t[8]=e=>o.newAuthor=e),label:"Автор"},null,8,["modelValue"]),(0,i.Wm)(f,{modelValue:o.newisFree,"onUpdate:modelValue":t[9]||(t[9]=e=>o.newisFree=e),label:"Бесплатное",style:{opacity:"60%"}},null,8,["modelValue"]),(0,i.Wm)(u,{modelValue:o.newDiffLevel,"onUpdate:modelValue":t[10]||(t[10]=e=>o.newDiffLevel=e),label:"Уровень сложности",options:s.getLevelOptions},{option:(0,i.w5)((e=>[(0,i.Wm)(_,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(y,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"]),(0,i.Wm)(m,{class:"q-mt-md",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[11]||(t[11]=e=>s.addNewChource())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(V),(0,i.Wm)(q,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((a=>[(0,i.Wm)(x,{props:a},{default:(0,i.w5)((()=>[(0,i.Wm)(W,{key:"title",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.title),1),(0,i.Wm)(w,{modelValue:a.row.title,"onUpdate:modelValue":e=>a.row.title=e,onHide:e=>s.changeChourceTitle(a.row._id,a.row.title)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.title,"onUpdate:modelValue":e=>a.row.title=e,label:"Заголовок"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"image_url",props:a},{default:(0,i.w5)((()=>[a.row.image_url?((0,i.wg)(),(0,i.j4)(m,{key:0,href:a.row.image_url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(a.row.image_url))+" ",1),(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_2,"onUpdate:modelValue":t[15]||(t[15]=e=>o.file_2=e),onHide:e=>s.changeChourceImage(a.row._id,a.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[14]||(t[14]=e=>o.file=e),e=>s.uploadFileB(a.row._id)],label:"Выберете изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onHide"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:2},1024),(0,i.Wm)(w,{modelValue:a.row.image_url,"onUpdate:modelValue":e=>a.row.image_url=e,onHide:e=>s.changeChourceImage(a.row._id,a.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.image_url,"onUpdate:modelValue":e=>a.row.image_url=e,label:"Ссылка титульное изображение"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"text",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.text),1),(0,i.Wm)(w,{modelValue:a.row.text,"onUpdate:modelValue":e=>a.row.text=e,onHide:e=>s.changeChourceText(a.row._id,a.row.text)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.text,"onUpdate:modelValue":e=>a.row.text=e,label:"Описание"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"author",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.author),1),(0,i.Wm)(w,{modelValue:a.row.author,"onUpdate:modelValue":e=>a.row.author=e,onHide:e=>s.changeChourceAuthor(a.row._id,a.row.author)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.author,"onUpdate:modelValue":e=>a.row.author=e,label:"Описание"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"isFree",props:a},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{modelValue:a.row.isFree,"onUpdate:modelValue":e=>a.row.isFree=e,color:"grey-8",onClick:e=>s.changeIsFree(a.row._id,a.row.isFree)},null,8,["modelValue","onUpdate:modelValue","onClick"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"level",props:a},{default:(0,i.w5)((()=>[a.row.level?((0,i.wg)(),(0,i.j4)(y,{key:0,style:(0,B.j5)({"background-color":`${o.levelsref[a.row.level].level.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(o.levelsref[a.row.level].level.name),1)])),_:2},1032,["style"])):(0,i.kq)("",!0),(0,i.Wm)(w,{modelValue:a.row.level,"onUpdate:modelValue":e=>a.row.level=e,onHide:e=>s.updateLevel(a.row._id,a.row.level)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{"emit-value":"","map-options":"",modelValue:a.row.level,"onUpdate:modelValue":e=>a.row.level=e,label:"Уровень сложности",options:s.getLevelOptions},{option:(0,i.w5)((e=>[(0,i.Wm)(_,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(y,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"dir",props:a},{default:(0,i.w5)((()=>[a.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(a.row.dir,(e=>((0,i.wg)(),(0,i.iD)("div",null,[e?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e,(e=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(y,{removable:"",clickabl:"",onRemove:t=>s.delTag(a.row._id,e.id),style:(0,B.j5)({"background-color":`${e.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(m,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(w,{modelValue:o.model,"onUpdate:modelValue":t[17]||(t[17]=e=>o.model=e),onHide:e=>s.addNewTags(a.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[16]||(t[16]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(_,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(y,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(W,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:e=>(o.edit=!0,o.currentVideos=a.row.videos,o.currentChourceId=a.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"edit"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Редактировать содержимое")])),_:1})])),_:2},1032,["onClick"]),(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,e.deleteRowId=a.row._id,e.deletUserName=a.row.username),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",zs,Ns)):(0,i.kq)("",!0)]),(0,i.Wm)(v,{modelValue:o.confirm,"onUpdate:modelValue":t[19]||(t[19]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(b,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[js])),_:1}),(0,i.Wm)(S,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[U]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[18]||(t[18]=t=>s.removeChource(e.deleteRowId,e.deletUserName)),color:"primary"},null,512),[[U]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(v,{modelValue:o.edit,"onUpdate:modelValue":t[23]||(t[23]=e=>o.edit=e),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{style:{"background-color":"#738664"}},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{style:{"background-color":"white"},class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[Ls,(0,i.Wm)(c),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{dense:"",flat:"",icon:"close",onClick:t[20]||(t[20]=e=>o.currentVideos=[])},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Закрыть")])),_:1})])),_:1})),[[U]])])),_:1}),(0,i.Wm)(p,{style:{"background-color":"white"}},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{color:"grey-8",flat:"",icon:"save",onClick:t[21]||(t[21]=e=>s.saveVideos(o.currentChourceId,o.currentVideos))},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Сохранить")])),_:1})])),_:1}),(0,i.Wm)(m,{color:"grey-8",onClick:t[22]||(t[22]=e=>s.addVideo()),flat:"",icon:"add"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i._)("div",Qs,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.currentVideos,((e,t)=>((0,i.wg)(),(0,i.j4)(b,{style:{"min-width":"450px"},class:"col-2 q-ma-lg q-pa-lg"},{default:(0,i.w5)((()=>[(0,i._)("div",Is,[(0,i._)("div",Os,(0,B.zw)(t+1),1),(0,i._)("div",Ps,[(0,i.Wm)(m,{color:"grey-8",flat:"",onClick:t=>s.deleteVideo(e),icon:"delete"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])]),(0,i.Wm)(d,{modelValue:e.title,"onUpdate:modelValue":t=>e.title=t,label:"Заголовок"},null,8,["modelValue","onUpdate:modelValue"]),(0,i.Wm)(d,{modelValue:e.text,"onUpdate:modelValue":t=>e.text=t,label:"Описание"},null,8,["modelValue","onUpdate:modelValue"]),(0,i.Wm)(d,{modelValue:e.video,"onUpdate:modelValue":t=>e.video=t,label:"Ссылка на видео"},null,8,["modelValue","onUpdate:modelValue"]),(0,i._)("iframe",{src:e.video,style:{width:"100%",height:"250px"}},null,8,Hs)])),_:2},1024)))),256))])])),_:1})])),_:1})])),_:1},8,["modelValue"])],64)}const Fs={data(){return{file_1:null,file_2:null,modaladdvideo:(0,s.iH)(!1),columns:[{name:"title",label:"Название",align:"left",field:"title",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"image_url",label:"Титульное изображение",align:"left",field:"image_url",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"text",align:"left",label:"Описание",field:"text",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"author",align:"left",label:"Автор",field:"author",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"isFree",align:"left",label:"Бесплатный",field:"isFree",canEdit:!0,sortable:!0,forSeacrch:!1},{name:"level",align:"left",label:"Уровень сложности",field:"level",canEdit:!0,sortable:!0,forSeacrch:!1},{name:"dir",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1,forSeacrch:!1},{name:"control",align:"left",label:"Управление"}],tags:[],levels:[],levelsref:{},rows:[],text:"",model:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",confirm:(0,s.iH)(!1),edit:(0,s.iH)(!1),error:0,loaded:!1,searchSelected:"",icon:(0,s.iH)(!1),newTitle:"",newText:"",newImage_url:"",newAuthor:"",newisFree:!1,newTags:[],newDiffLevel:"",file:(0,s.iH)(null),currentVideos:[],currentChourceId:""}},async beforeMount(){await this.getChildTag(),await this.getLevels(),await this.getChource(),this.searchSelected=this.getSearchParamsArray[0]},methods:{deleteVideo(e){let t=this.currentVideos.indexOf(e);this.currentVideos.splice(t,1)},addVideo(){this.currentVideos.push({title:"",text:"",video:""})},async saveVideos(e,t){try{await b.api.put("api/chource/"+e,{videos:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Курс сохранен"})}catch(a){this.onError(a)}},async removeChource(e){try{await b.api["delete"]("api/chource/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Курс удален"}),this.getChource()}catch(t){this.onError(t)}},async changeIsFree(e,t){try{await b.api.put("api/chource/"+e,{isFree:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Автор сохранено"})}catch(a){this.onError(a)}},async changeChourceAuthor(e,t){try{await b.api.put("api/chource/"+e,{author:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Автор сохранено"})}catch(a){this.onError(a)}},async changeChourceText(e,t){try{await b.api.put("api/chource/"+e,{text:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Описание сохранено"})}catch(a){this.onError(a)}},async changeChourceImage(e,t){try{await b.api.put("api/chource/"+e,{image_url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка на изображение сохранена"})}catch(a){this.onError(a)}},async changeChourceTitle(e,t){try{await b.api.put("api/chource/"+e,{title:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Заголовок сохранен"})}catch(a){this.onError(a)}},async uploadFileB(e){if(null==this.file)return;let t=new FormData;t.append("file",this.file);try{const a=await b.api.post("api/uploads/create/",t,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows.forEach((t=>{t._id==e&&(t.image_url=a.data)})),this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(a){this.onError(a)}},async uploadFileA(){if(null==this.file)return;let e=new FormData;e.append("file",this.file);try{const t=await b.api.post("api/uploads/create/",e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.newImgUrl=t.data,this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(t){this.onError(t)}},async getLevels(){try{const e=await b.api.get("api/level",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.levels=e.data,e.data.forEach((e=>{this.levelsref[e._id]={level:e}}))}catch(e){this.onError(e)}},async getChildTag(){try{const e=await b.api.get("api/childDir/",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},async updateLevel(e,t){try{await b.api.put("api/chource/"+e,{level:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Уровень сложности сохранен"})}catch(a){this.onError(a)}},async getChource(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/chource/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/chource/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getChource()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/chource/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getChource()}catch(a){this.onError(a)}},async addNewChource(){try{await b.api.post("api/chource/",{title:this.newTitle,text:this.newText,author:this.newAuthor,level:this.newDiffLevel.value,image_url:this.newImage_url,isFree:this.newisFree},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Курс успешно добавлен."}),this.getChource(),this.newTitle="",this.newText="",this.newAuthor="",this.newDiffLevel="",this.newImage_url="",this.newisFree=!1,this.icon=!1}catch(e){this.onError(e)}}},computed:{getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getLevelOptions(){let e=[];return this.levels.forEach((t=>{e.push({label:t.name,color:t.color,value:t._id})})),e},getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&t.forSeacrch&&e.push(t.label)})),e}}},Bs=(0,d.Z)(Fs,[["render",$s],["__scopeId","data-v-673e56fe"]]),Ys=Bs;E()(Fs,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupEdit:Ya.Z,QFile:Ul.Z,QTooltip:Va.Z,QCheckbox:io.Z,QItem:ee.Z,QChip:Dl.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QCardActions:Ga.Z}),E()(Fs,"directives",{ClosePopup:Ka.Z});const Rs=e=>((0,i.dD)("data-v-38db9a6e"),e=e(),(0,i.Cn)(),e),Gs={key:1},Ks={class:"row"},Js={class:"col-auto"},Xs={class:"col-auto"},ei={class:"col q-mt-sm"},ti=Rs((()=>(0,i._)("div",{class:"text-h6"},"Добавления нового уровня сложности",-1))),ai={key:2,class:"text-center"},li=Rs((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),oi=Rs((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),si=[li,oi],ii=Rs((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1)));function ri(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-color"),w=(0,i.up)("q-card"),g=(0,i.up)("q-dialog"),f=(0,i.up)("q-separator"),y=(0,i.up)("q-th"),_=(0,i.up)("q-popup-edit"),b=(0,i.up)("q-td"),v=(0,i.up)("q-chip"),V=(0,i.up)("q-tooltip"),k=(0,i.up)("q-tr"),W=(0,i.up)("q-table"),x=(0,i.up)("q-card-actions"),q=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",Gs,[(0,i._)("div",Ks,[(0,i._)("div",Js,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",Xs,[(0,i.Wm)(u,{borderless:"",modelValue:o.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>o.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",ei,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[6]||(t[6]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:o.icon,"onUpdate:modelValue":t[5]||(t[5]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[ti,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[q]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newName,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newName=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(h,{modelValue:o.newColor,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newColor=e),"no-header-tabs":"","no-footer":""},null,8,["modelValue"]),(0,i.Wm)(m,{class:"q-mt-lg",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[4]||(t[4]=e=>s.addLevel())},{default:(0,i.w5)((()=>[(0,i.Uk)("Принять")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(f),(0,i.Wm)(W,{pagination:o.pagination,"onUpdate:pagination":t[7]||(t[7]=e=>o.pagination=e),"rows-per-page-options":[0],flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(y,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((e=>[(0,i.Wm)(k,{props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{key:"name",props:e},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(e.row.name),1),(0,i.Wm)(_,{modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,onHide:t=>s.changeTagName(e.row._id,e.row.name)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:e.row.name,"onUpdate:modelValue":t=>e.row.name=t,label:"Название тега"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"color",props:e},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{style:(0,B.j5)([{"background-color":`${e.row.color}`},{"font-size":"16px"}]),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.row.name)+" ",1),(0,i.Wm)(_,{modelValue:e.row.fact_text,"onUpdate:modelValue":t=>e.row.fact_text=t,onHide:t=>s.changeLevelDiffColor(e.row._id,e.row.color)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:e.row.color,"onUpdate:modelValue":t=>e.row.color=t,"no-header-tabs":"","no-footer":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["style"])])),_:2},1032,["props"]),(0,i.Wm)(b,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,o.deleteRowId=e.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(V,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["pagination","rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",ai,si)):(0,i.kq)("",!0),(0,i.Wm)(g,{modelValue:o.confirm,"onUpdate:modelValue":t[9]||(t[9]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[ii])),_:1}),(0,i.Wm)(x,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[q]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[8]||(t[8]=e=>s.deleteLevel(o.deleteRowId)),color:"primary"},null,512),[[q]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}const ni={data(){return{deleteRowId:-1,pagination:(0,s.iH)(null),confirm:(0,s.iH)(!1),icon:(0,s.iH)(!1),newColor:"#000000",newName:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",text:"",searchSelected:"",columns:[{name:"name",align:"left",label:"Название",field:"name",canEdit:!0,sortable:!0},{name:"color",align:"left",label:"Цвет",canEdit:!0,sortable:!1},{name:"control",align:"left",label:"Управление"}],rows:[],error:0,loaded:!1}},mounted(){this.getLevels(),this.searchSelected=this.getSearchParamsArray[0]},methods:{async getLevels(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/level",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},async changeTagName(e,t){try{await b.api.put("api/level/"+e,{name:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Название сохранено"}),this.getLevels()}catch(a){this.onError(a)}},async changeLevelDiffColor(e,t){try{await b.api.put("api/level/"+e,{color:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Цвет сохранен"}),this.getLevels()}catch(a){this.onError(a)}},async addLevel(){try{await b.api.post("api/level",{name:this.newName,color:this.newColor},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Уровень сложности добавлен"}),this.icon=!1,this.newColor="#000000",this.newName="",this.getLevels()}catch(e){this.onError(e)}},async deleteLevel(e){try{await b.api["delete"]("api/level/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Уровень сложности удален удален"}),this.getLevels()}catch(t){this.onError(t)}},onError(e){console.log(e),this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})}},computed:{getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&e.push(t.label)})),e},getParentSelectOptions(){let e=[];return this.rows.forEach((t=>{e.push({label:t.name,value:t._id})})),e}}},di=(0,d.Z)(ni,[["render",ri],["__scopeId","data-v-38db9a6e"]]),ui=di;E()(ni,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QColor:Ws.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QPopupEdit:Ya.Z,QChip:Dl.Z,QTooltip:Va.Z,QCardActions:Ga.Z}),E()(ni,"directives",{ClosePopup:Ka.Z});const ci=e=>((0,i.dD)("data-v-6f9648b6"),e=e(),(0,i.Cn)(),e),mi={key:1},pi={class:"row"},hi={class:"col-auto"},wi={class:"col-auto"},gi={class:"col q-mt-sm"},fi=ci((()=>(0,i._)("div",{class:"text-h6"},"Добавление теста",-1))),yi={key:2,class:"text-center"},_i=ci((()=>(0,i._)("div",{class:"text-h4",style:{opacity:"0.5"}},"У вас нет прав",-1))),bi=ci((()=>(0,i._)("img",{class:"image",src:Ea()},null,-1))),vi=[_i,bi],Vi=ci((()=>(0,i._)("span",{class:"q-ml-sm"},"Вы точно хотите удалить запись?",-1))),ki=ci((()=>(0,i._)("div",{class:"text-h5"},"Редактор теста",-1))),Wi={class:"row"},xi={class:"row justify-between"},qi={class:"col-8 text-h6",style:{color:"gray"}},Si={class:"col-1"},Ui=["src"];function Di(e,t,a,l,o,s){const r=(0,i.up)("q-spinner-ball"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-select"),c=(0,i.up)("q-space"),m=(0,i.up)("q-btn"),p=(0,i.up)("q-card-section"),h=(0,i.up)("q-file"),w=(0,i.up)("q-popup-edit"),g=(0,i.up)("q-tooltip"),f=(0,i.up)("q-chip"),y=(0,i.up)("q-item"),_=(0,i.up)("q-card"),b=(0,i.up)("q-dialog"),v=(0,i.up)("q-separator"),V=(0,i.up)("q-th"),k=(0,i.up)("q-td"),W=(0,i.up)("q-tr"),x=(0,i.up)("q-table"),q=(0,i.up)("q-card-actions"),S=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",null,[o.loaded?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(r,{key:0,class:"fixed-center",size:"5rem",color:"white",thickness:3})),o.loaded&&!o.error?((0,i.wg)(),(0,i.iD)("div",mi,[(0,i._)("div",pi,[(0,i._)("div",hi,[(0,i.Wm)(d,{style:{"padding-bottom":"0px"},"bottom-slots":"",borderless:"",modelValue:o.text,"onUpdate:modelValue":t[0]||(t[0]=e=>o.text=e),label:"Поиск"},{prepend:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"search"})])),_:1},8,["modelValue"])]),(0,i._)("div",wi,[(0,i.Wm)(u,{borderless:"",modelValue:this.searchSelected,"onUpdate:modelValue":t[1]||(t[1]=e=>this.searchSelected=e),options:s.getSearchParamsArray},null,8,["modelValue","options"])]),(0,i._)("div",gi,[(0,i.Wm)(m,{flat:"",icon:"add",onClick:t[11]||(t[11]=e=>o.icon=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(b,{modelValue:o.icon,"onUpdate:modelValue":t[10]||(t[10]=e=>o.icon=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"bg-white text-black add-fact"},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[fi,(0,i.Wm)(c),(0,i.wy)((0,i.Wm)(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[S]])])),_:1}),(0,i.Wm)(p,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.newTitle,"onUpdate:modelValue":t[2]||(t[2]=e=>o.newTitle=e),label:"Название"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newText,"onUpdate:modelValue":t[3]||(t[3]=e=>o.newText=e),label:"Описание"},null,8,["modelValue"]),(0,i.Wm)(d,{modelValue:o.newImage_url,"onUpdate:modelValue":t[7]||(t[7]=e=>o.newImage_url=e),label:"Ссылка на титульное изображение"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_1,"onUpdate:modelValue":t[6]||(t[6]=e=>o.file_1=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[4]||(t[4]=e=>o.file=e),t[5]||(t[5]=e=>s.uploadFileA())],label:"Выберите изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue"])])),_:1},8,["modelValue"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(u,{modelValue:o.newDiffLevel,"onUpdate:modelValue":t[8]||(t[8]=e=>o.newDiffLevel=e),label:"Уровень сложности",options:s.getLevelOptions},{option:(0,i.w5)((e=>[(0,i.Wm)(y,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(f,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"]),(0,i.Wm)(m,{class:"q-mt-md",flat:"",style:{width:"100%","background-color":"rgba(7, 7, 7, 0.05)"},onClick:t[9]||(t[9]=e=>s.addNewTest())},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])]),(0,i.Wm)(v),(0,i.Wm)(x,{flat:"",borderless:"",separator:"cell",rows:s.getRows,columns:o.columns,"row-key":"name","no-data-label":"Ничего не найдено"},{"header-cell":(0,i.w5)((e=>[(0,i.Wm)(V,{props:e},{default:(0,i.w5)((()=>[e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:0,name:"lock_open",size:"1.5em"})):null!=e.col.canEdit?((0,i.wg)(),(0,i.j4)(n,{key:1,name:"lock",size:"1.5em"})):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(e.col.label),1)])),_:2},1032,["props"])])),body:(0,i.w5)((a=>[(0,i.Wm)(W,{props:a},{default:(0,i.w5)((()=>[(0,i.Wm)(k,{key:"title",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.title),1),(0,i.Wm)(w,{modelValue:a.row.title,"onUpdate:modelValue":e=>a.row.title=e,onHide:e=>s.changeTestTitle(a.row._id,a.row.title)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.title,"onUpdate:modelValue":e=>a.row.title=e,label:"Заголовок"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"image_url",props:a},{default:(0,i.w5)((()=>[a.row.image_url?((0,i.wg)(),(0,i.j4)(m,{key:0,href:a.row.image_url,target:"_blank",flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"link"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Перейти по ссылке")])),_:1})])),_:2},1032,["href"])):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,B.zw)(s.getShortText(a.row.image_url))+" ",1),(0,i.Wm)(m,{flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"upload"}),(0,i.Wm)(w,{modelValue:o.file_2,"onUpdate:modelValue":t[13]||(t[13]=e=>o.file_2=e),onHide:e=>s.changeTestImage(a.row._id,a.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{modelValue:o.file,"onUpdate:modelValue":[t[12]||(t[12]=e=>o.file=e),e=>s.uploadFileB(a.row._id)],label:"Выберете изображение",outlined:"",accept:".jpg, .jpeg, .png","use-chips":"",style:{"max-width":"300px"}},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onHide"]),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Загрузить новове изображение")])),_:1})])),_:2},1024),(0,i.Wm)(w,{modelValue:a.row.image_url,"onUpdate:modelValue":e=>a.row.image_url=e,onHide:e=>s.changeTestImage(a.row._id,a.row.image_url)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.image_url,"onUpdate:modelValue":e=>a.row.image_url=e,label:"Ссылка титульное изображение"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"text",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.text),1),(0,i.Wm)(w,{modelValue:a.row.text,"onUpdate:modelValue":e=>a.row.text=e,onHide:e=>s.changeTestText(a.row._id,a.row.text)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.text,"onUpdate:modelValue":e=>a.row.text=e,label:"Описание"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"tasks",props:a},{default:(0,i.w5)((()=>[(0,i._)("div",null,(0,B.zw)(a.row.tasks),1),(0,i.Wm)(w,{modelValue:a.row.tasks,"onUpdate:modelValue":e=>a.row.tasks=e,onHide:e=>s.changeTestTask(a.row._id,a.row.tasks)},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{type:"textarea",modelValue:a.row.tasks,"onUpdate:modelValue":e=>a.row.tasks=e,label:"Видео"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"level",props:a},{default:(0,i.w5)((()=>[a.row.level?((0,i.wg)(),(0,i.j4)(f,{key:0,style:(0,B.j5)({"background-color":`${o.levelsref[a.row.level].level.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(o.levelsref[a.row.level].level.name),1)])),_:2},1032,["style"])):(0,i.kq)("",!0),(0,i.Wm)(w,{modelValue:a.row.level,"onUpdate:modelValue":e=>a.row.level=e,onHide:e=>s.updateLevel(a.row._id,a.row.level)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{"emit-value":"","map-options":"",modelValue:a.row.level,"onUpdate:modelValue":e=>a.row.level=e,label:"Уровень сложности",options:s.getLevelOptions},{option:(0,i.w5)((e=>[(0,i.Wm)(y,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(f,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:2},1032,["modelValue","onUpdate:modelValue","options"])])),_:2},1032,["modelValue","onUpdate:modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"dir",props:a},{default:(0,i.w5)((()=>[a.row.dir?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(a.row.dir,(e=>((0,i.wg)(),(0,i.iD)("div",null,[e?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(e,(e=>((0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(f,{removable:"",clickabl:"",onRemove:t=>s.delTag(a.row._id,e.id),style:(0,B.j5)({"background-color":`${e.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.name),1)])),_:2},1032,["onRemove","style"])])))),256)):(0,i.kq)("",!0)])))),256)):(0,i.kq)("",!0),(0,i.Wm)(m,{icon:"add",size:"sm",round:"",dense:""}),(0,i.Wm)(w,{modelValue:o.model,"onUpdate:modelValue":t[15]||(t[15]=e=>o.model=e),onHide:e=>s.addNewTags(a.row._id,o.model)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{modelValue:o.model,"onUpdate:modelValue":t[14]||(t[14]=e=>o.model=e),"emit-value":"","map-options":"",options:s.getTagSelectOptions,style:{width:"250px"}},{option:(0,i.w5)((e=>[(0,i.Wm)(y,(0,B.vs)((0,i.F4)(e.itemProps)),{default:(0,i.w5)((()=>[(0,i.Wm)(f,{style:(0,B.j5)({"background-color":`${e.opt.color}`}),"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.opt.label),1)])),_:2},1032,["style"])])),_:2},1040)])),_:1},8,["modelValue","options"])])),_:2},1032,["modelValue","onHide"])])),_:2},1032,["props"]),(0,i.Wm)(k,{key:"control"},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{onClick:e=>(o.edit=!0,o.currentTasks=a.row.tasks,o.currentChourceId=a.row._id),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"edit"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Редактировать содержимое")])),_:1})])),_:2},1032,["onClick"]),(0,i.Wm)(m,{onClick:t=>(o.confirm=!0,e.deleteRowId=a.row._id,e.deletUserName=a.row.username),flat:"",dense:"",color:"grey-8"},{default:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"delete_forever"}),(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["props"])])),_:1},8,["rows","columns"])])):(0,i.kq)("",!0),403==o.error?((0,i.wg)(),(0,i.iD)("div",yi,vi)):(0,i.kq)("",!0)]),(0,i.Wm)(b,{modelValue:o.confirm,"onUpdate:modelValue":t[17]||(t[17]=e=>o.confirm=e),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(_,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{class:"row items-center"},{default:(0,i.w5)((()=>[Vi])),_:1}),(0,i.Wm)(q,{align:"between"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Отмена",color:"primary"},null,512),[[S]]),(0,i.wy)((0,i.Wm)(m,{flat:"",label:"Удалить",onClick:t[16]||(t[16]=t=>s.removeTest(e.deleteRowId,e.deletUserName)),color:"primary"},null,512),[[S]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(b,{modelValue:o.edit,"onUpdate:modelValue":t[21]||(t[21]=e=>o.edit=e),persistent:"",maximized:!0,"transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{style:{"background-color":"#738664"}},{default:(0,i.w5)((()=>[(0,i.Wm)(p,{style:{"background-color":"white"},class:"row items-center q-pb-none"},{default:(0,i.w5)((()=>[ki,(0,i.Wm)(c),(0,i.wy)(((0,i.wg)(),(0,i.j4)(m,{dense:"",flat:"",icon:"close",onClick:t[18]||(t[18]=e=>o.currentTasks=[])},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Закрыть")])),_:1})])),_:1})),[[S]])])),_:1}),(0,i.Wm)(p,{style:{"background-color":"white"}},{default:(0,i.w5)((()=>[(0,i.Wm)(m,{color:"grey-8",flat:"",icon:"save",onClick:t[19]||(t[19]=e=>s.saveTasks(o.currentChourceId,o.currentTasks))},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Сохранить")])),_:1})])),_:1}),(0,i.Wm)(m,{color:"grey-8",onClick:t[20]||(t[20]=e=>s.addTasks()),flat:"",icon:"add"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Добавить")])),_:1})])),_:1})])),_:1}),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i._)("div",Wi,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.currentTasks,((e,t)=>((0,i.wg)(),(0,i.j4)(_,{style:{"min-width":"450px"},class:"col-2 q-ma-lg q-pa-lg"},{default:(0,i.w5)((()=>[(0,i._)("div",xi,[(0,i._)("div",qi,(0,B.zw)(t+1),1),(0,i._)("div",Si,[(0,i.Wm)(m,{color:"grey-8",flat:"",onClick:t=>s.deleteTasks(e),icon:"delete"},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{class:"bg-white text-primary"},{default:(0,i.w5)((()=>[(0,i.Uk)("Удалить")])),_:1})])),_:2},1032,["onClick"])])]),(0,i.Wm)(d,{modelValue:e.title,"onUpdate:modelValue":t=>e.title=t,label:"Заголовок"},null,8,["modelValue","onUpdate:modelValue"]),(0,i.Wm)(d,{modelValue:e.text,"onUpdate:modelValue":t=>e.text=t,label:"Описание"},null,8,["modelValue","onUpdate:modelValue"]),(0,i.Wm)(d,{modelValue:e.video,"onUpdate:modelValue":t=>e.video=t,label:"Ссылка на видео"},null,8,["modelValue","onUpdate:modelValue"]),(0,i._)("iframe",{src:e.video,style:{width:"100%",height:"250px"}},null,8,Ui)])),_:2},1024)))),256))])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}const Ci={data(){return{file_1:null,file_2:null,modaladdvideo:(0,s.iH)(!1),columns:[{name:"title",label:"Название",align:"left",field:"title",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"image_url",label:"Титульное изображение",align:"left",field:"image_url",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"text",align:"left",label:"Описание",field:"text",canEdit:!0,sortable:!0,forSeacrch:!0},{name:"level",align:"left",label:"Уровень сложности",field:"level",canEdit:!0,sortable:!0,forSeacrch:!1},{name:"dir",align:"left",label:"Теги",field:"dir",canEdit:!0,sortable:!1,forSeacrch:!1},{name:"control",align:"left",label:"Управление"}],tags:[],levels:[],levelsref:{},rows:[],text:"",model:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",confirm:(0,s.iH)(!1),edit:(0,s.iH)(!1),error:0,loaded:!1,searchSelected:"",icon:(0,s.iH)(!1),newTitle:"",newText:"",newImage_url:"",newTags:[],newDiffLevel:"",file:(0,s.iH)(null),currentTasks:[],currentChourceId:""}},async beforeMount(){await this.getChildTag(),await this.getLevels(),await this.getTests(),this.searchSelected=this.getSearchParamsArray[0]},methods:{deleteTasks(e){let t=this.currentTasks.indexOf(e);this.currentTasks.splice(t,1)},addTasks(){this.currentTasks.push({title:"",text:"",video:""})},async saveTasks(e,t){try{await b.api.put("api/test/"+e,{tasks:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тест сохранен"})}catch(a){this.onError(a)}},async removeTest(e){try{await b.api["delete"]("api/test/"+e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тест удален"}),this.getTests()}catch(t){this.onError(t)}},async changeTestTask(e,t){try{await b.api.put("api/test/"+e,{author:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Автор сохранено"})}catch(a){this.onError(a)}},async changeTestText(e,t){try{await b.api.put("api/test/"+e,{text:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Описание сохранено"})}catch(a){this.onError(a)}},async changeTestImage(e,t){console.log("do");try{await b.api.put("api/test/"+e,{image_url:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}}),this.$q.notify({type:"positive",message:"Ссылка на изображение сохранена"})}catch(a){this.onError(a)}},async changeTestTitle(e,t){try{await b.api.put("api/test/"+e,{title:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Заголовок сохранен"})}catch(a){this.onError(a)}},async uploadFileB(e){if(null==this.file)return;let t=new FormData;t.append("file",this.file);try{const a=await b.api.post("api/uploads/create/",t,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows.forEach((t=>{t._id==e&&(t.image_url=a.data)})),this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(a){this.onError(a)}},async uploadFileA(){if(null==this.file)return;let e=new FormData;e.append("file",this.file);try{const t=await b.api.post("api/uploads/create/",e,{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.newImgUrl=t.data,this.file=null,this.$q.notify({type:"positive",message:"Изображение загружено"})}catch(t){this.onError(t)}},async getLevels(){try{const e=await b.api.get("api/level",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.levels=e.data,e.data.forEach((e=>{this.levelsref[e._id]={level:e}}))}catch(e){this.onError(e)}},async getChildTag(){try{const e=await b.api.get("api/childDir/",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.tags=e.data}catch(e){this.onError(e)}},async updateLevel(e,t){try{await b.api.put("api/test/"+e,{level:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Уровень сложности сохранен"})}catch(a){this.onError(a)}},async getTests(){this.loaded=!1,this.error=0;try{const e=await b.api.get("api/test/dir/s",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows=e.data,this.loaded=!0}catch(e){this.onError(e)}},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},getShortText(e,t=50){return e&&e.length>t?e.substring(0,t)+"...":e},async addNewTags(e,t){if(""!=this.model)try{await b.api.post("api/test/dir/s/",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Новый тэг успешно добавлен."}),this.model="",this.getTests()}catch(a){this.onError(a)}},async delTag(e,t){try{await b.api.post("api/test/dir/s/del",{id:e,dir:t},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тег успешно удален."}),this.getTests()}catch(a){this.onError(a)}},async addNewTest(){try{await b.api.post("api/test/",{title:this.newTitle,text:this.newText,level:this.newDiffLevel.value,image_url:this.newImage_url},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.$q.notify({type:"positive",message:"Тест успешно добавлен."}),this.getTests(),this.newTitle="",this.newText="",this.newDiffLevel="",this.newImage_url="",this.icon=!1}catch(e){this.onError(e)}}},computed:{getTagSelectOptions(){let e=[];return this.tags.forEach((t=>{e.push({label:t.name,value:t._id,color:t.color})})),e},getLevelOptions(){let e=[];return this.levels.forEach((t=>{e.push({label:t.name,color:t.color,value:t._id})})),e},getRows(){if(""!==this.text){let e,t=this.text,a=[];this.columns.forEach((t=>{t.label==this.searchSelected&&(e=t.field)}));let l=e.split(".");return this.rows.map((function(e){let o=e[l[0]];for(let t=1;t<l.length;t++)o=o[l[t]];"object"==typeof o?o.forEach((l=>{l.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})):o.toString().toLowerCase().includes(t.toString().toLowerCase())&&a.push(e)})),a}return this.rows},getSearchParamsArray(){let e=[];return this.columns.forEach((t=>{t.field&&t.forSeacrch&&e.push(t.label)})),e}}},Ei=(0,d.Z)(Ci,[["render",Di],["__scopeId","data-v-6f9648b6"]]),Ti=Ei;E()(Ci,"components",{QSpinnerBall:Ha.Z,QInput:q.Z,QIcon:U.Z,QSelect:va.Z,QBtn:D.Z,QDialog:Ra.Z,QCard:W.Z,QCardSection:x.Z,QSpace:Sl.Z,QPopupEdit:Ya.Z,QFile:Ul.Z,QTooltip:Va.Z,QItem:ee.Z,QChip:Dl.Z,QSeparator:S.Z,QTable:ka.Z,QTh:$a.Z,QTr:Fa.Z,QTd:Ba.Z,QCardActions:Ga.Z}),E()(Ci,"directives",{ClosePopup:Ka.Z});const Mi={components:{Roles:ml,Users:Xa,Facts:El,Event:uo,School:zo,News:Go,Direction:qs,Chource:Ys,Level:ui,Test:Ti},data(){return{selectedTable:"",userRoles:[]}},methods:{onError(e){e.response&&e.response.status?this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"}):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async getUserRoles(){try{const e=await b.api.post("auth/user",{username:V().get("login")},{headers:{Authorization:"Bearer "+V().get("token")}});this.userRoles=e.data.roles}catch(e){this.onError(e)}}},beforeMount(){this.getUserRoles()},computed:{getOptions(){let e=this.userRoles;return e==[]&&(V().remove("token"),this.$router.replace("/auth")),e.includes("ADMIN")?["Пользователи","Направления(теги)","Факты","Мероприятия","Школы","Новости","Уровни сложности","Курсы","Тесты"]:e.includes("MODERATOR")?["Направления(теги)","Факты","Мероприятия","Школы","Новости","Уровни сложности","Курсы","Тесты"]:[]}}},zi=(0,d.Z)(Mi,[["render",Da],["__scopeId","data-v-6ef9aa1d"]]),Ai=zi;E()(Mi,"components",{QCard:W.Z,QCardSection:x.Z,QSelect:va.Z});var Zi=a(2822),Ni=a.n(Zi);const ji=e=>((0,i.dD)("data-v-4803d575"),e=e(),(0,i.Cn)(),e),Li={class:"row q-pt-lg justify-end"},Qi={class:"text-center"},Ii=ji((()=>(0,i._)("div",null,"Идет отправка сообщения",-1))),Oi={class:"text-center"},Pi=ji((()=>(0,i._)("img",{class:"img",src:Ni()},null,-1))),Hi={class:"text-h4",style:{opacity:"0.5"}};function $i(e,t,a,l,o,s){const r=(0,i.up)("q-input"),n=(0,i.up)("q-btn"),d=(0,i.up)("q-form"),u=(0,i.up)("q-card-section"),c=(0,i.up)("q-spinner-gears"),m=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(m,null,{default:(0,i.w5)((()=>[o.sendProcessStart?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(u,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(d,{class:"q-px-md q-py-md my-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{modelValue:o.username,"onUpdate:modelValue":t[0]||(t[0]=e=>o.username=e),label:"Имя пользователя"},null,8,["modelValue"]),(0,i.Wm)(r,{modelValue:o.theme,"onUpdate:modelValue":t[1]||(t[1]=e=>o.theme=e),label:"Тема обращения"},null,8,["modelValue"]),(0,i.Wm)(r,{modelValue:o.text,"onUpdate:modelValue":t[2]||(t[2]=e=>o.text=e),type:"textarea",label:"Ваши вопросы и предложения"},null,8,["modelValue"]),(0,i._)("div",Li,[(0,i.Wm)(n,{flat:"",class:"button",onClick:s.sendMail,label:"Отправить"},null,8,["onClick"])])])),_:1})])),_:1})),o.sendProcessStart&&o.showSpinner?((0,i.wg)(),(0,i.j4)(u,{key:1},{default:(0,i.w5)((()=>[(0,i._)("div",Qi,[(0,i.Wm)(c,{size:"100px",color:"primary"}),Ii])])),_:1})):(0,i.kq)("",!0),o.sendProcessStart&&!o.showSpinner?((0,i.wg)(),(0,i.j4)(u,{key:2},{default:(0,i.w5)((()=>[(0,i._)("div",Oi,[Pi,(0,i._)("div",Hi,(0,B.zw)(this.sendResult),1),(0,i.Wm)(n,{class:"text-h6 button",style:{opacity:"0.5"},unelevated:"",onClick:s.semdMore,label:"Отправить еще одно обращение","no-caps":""},null,8,["onClick"])])])),_:1})):(0,i.kq)("",!0)])),_:1})}const Fi={data(){return{sendProcessStart:!1,theme:"",username:"",text:"",show:!1,showSpinner:!1,sendResult:"",auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2"}},methods:{clearForm(){this.theme="",this.text="",this.username=""},semdMore(){this.sendProcessStart=!1,this.clearForm()},showModal(){this.show=!0,this.showSpinner=!0,setTimeout((()=>{this.showSpinner=!1,this.message="Ваше сообщение успешно отпправлено!",setTimeout((()=>{this.show=!1,this.message=""}),2e3)}),3e3)},async sendMail(){if(""!=this.username)if(""!=this.theme)if(""!=this.message)try{this.showSpinner=!0,this.sendProcessStart=!0;await b.api.post("api/mail/send",{email:this.username,subject:this.theme,message:this.text},{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.showSpinner=!1,this.sendResult="Доставкой вашего письма занимается наш самый ответственный сотрудик!"}catch(e){this.showSpinner=!1,this.sendResult="При отправке сообщения возникла ошибка."}else this.$q.notify({type:"negative",message:"Вы не текст сообщения"});else this.$q.notify({type:"negative",message:"Вы не ввели тему обращения"});else this.$q.notify({type:"negative",message:"Вы не ввели свою контактную информацию"})}}};var Bi=a(8326),Yi=a(9120);const Ri=(0,d.Z)(Fi,[["render",$i],["__scopeId","data-v-4803d575"]]),Gi=Ri;E()(Fi,"components",{QCard:W.Z,QCardSection:x.Z,QForm:Bi.Z,QInput:q.Z,QBtn:D.Z,QSpinnerGears:Yi.Z});const Ki=e=>((0,i.dD)("data-v-286719c3"),e=e(),(0,i.Cn)(),e),Ji={class:"row"},Xi={class:"col"},er=Ki((()=>(0,i._)("div",{class:"text-h6"},"Данные пользователя",-1))),tr={class:"col"},ar=Ki((()=>(0,i._)("div",{class:"text-h6"},"Изменение пароля",-1)));function lr(e,t,a,l,o,s){const r=(0,i.up)("q-card-section"),n=(0,i.up)("q-icon"),d=(0,i.up)("q-input"),u=(0,i.up)("q-separator"),c=(0,i.up)("q-btn"),m=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(m,null,{default:(0,i.w5)((()=>[(0,i._)("div",Ji,[(0,i._)("div",Xi,[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[er])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{readonly:o.cantEdit,modelValue:o.name,"onUpdate:modelValue":t[1]||(t[1]=e=>o.name=e),hint:"Имя пользователя",onBlur:t[2]||(t[2]=e=>s.changeName())},{append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:"edit",class:"cursor-pointer",onClick:t[0]||(t[0]=e=>o.cantEdit=!o.cantEdit)})])),_:1},8,["readonly","modelValue"]),(0,i.Wm)(d,{readonly:!0,modelValue:o.username,"onUpdate:modelValue":t[3]||(t[3]=e=>o.username=e),hint:"Адрес эл. почты"},null,8,["modelValue"])])),_:1})]),(0,i.Wm)(u,{vertical:"",inset:""}),(0,i._)("div",tr,[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[ar])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.password,"onUpdate:modelValue":t[5]||(t[5]=e=>o.password=e),type:o.isPwd?"password":"text",label:"Новый пароль"},{append:(0,i.w5)((()=>[(0,i.Wm)(n,{name:o.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[4]||(t[4]=e=>o.isPwd=!o.isPwd)},null,8,["name"])])),_:1},8,["modelValue","type"])])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,{modelValue:o.password_again,"onUpdate:modelValue":t[6]||(t[6]=e=>o.password_again=e),type:o.isPwd?"password":"text",label:"Подтвержение пароля"},null,8,["modelValue","type"])])),_:1}),(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[(0,i.Wm)(c,{flat:"",class:"button",label:"Изменить пароль",onClick:s.changeUserPass},null,8,["onClick"])])),_:1})])])])),_:1})}const or={beforeMount(){this.username=V().get("login"),this.name=V().get("uname")},data(){return{password:"",password_again:"",isPwd:(0,s.iH)(!0),username:"",name:"",cantEdit:!0}},methods:{async changeName(){if(this.cantEdit=!0,""!=this.name){if(V().get("uname")!=this.name)try{const e=await b.api.post("auth/user",{username:V().get("login")},{headers:{Authorization:"Bearer "+V().get("token")}});await b.api.put("auth/updateUser/"+e.data._id,{name:this.name},{headers:{Authorization:"Bearer "+V().get("token")}});this.$q.notify({type:"positive",message:"Имя пользователя изменено"}),V().set("uname",this.name,"10h"),window.location.reload()}catch(e){this.name=V().get("uname"),this.onError(e)}}else this.$q.notify({type:"negative",message:"Имя пользователя не может быть пустым"})},onError(e){this.loaded=!0,e.response&&e.response.status?(this.error=e.response.status,403!=this.error&&this.$q.notify({type:"negative",message:e.response.data.message??"Ошибка сервера"})):this.$q.notify({type:"negative",message:"Нет соединения с сервером"})},async changeUserPass(){if(""==this.password||this.password<4)return void this.$q.notify({type:"negative",message:"Новый пароль должен быть более 3 символов"});if(""==this.password_again)return void this.$q.notify({type:"negative",message:"Введите подтверждение пароля"});const e=/^[a-zA-Z._0-9]+$/;if(e.test(this.password))if(this.password_again==this.password)try{const e=await b.api.post("auth/user",{username:V().get("login")},{headers:{Authorization:"Bearer "+V().get("token")}});await b.api.put("auth/updateUser/"+e.data._id,{password:this.password},{headers:{Authorization:"Bearer "+V().get("token")}}),this.loaded=!0,this.$q.notify({type:"positive",message:"Пароль изменен"})}catch(t){this.onError(t)}else this.$q.notify({type:"negative",message:"Пароли не совпадают"});else this.$q.notify({type:"negative",message:"Пароль должен содержать только буквы a-z, A-Z, точку (.) и символ подчеркивания (_)"})}}},sr=(0,d.Z)(or,[["render",lr],["__scopeId","data-v-286719c3"]]),ir=sr;E()(or,"components",{QCard:W.Z,QCardSection:x.Z,QInput:q.Z,QIcon:U.Z,QSeparator:S.Z,QBtn:D.Z});const rr=e=>((0,i.dD)("data-v-7e8aa9eb"),e=e(),(0,i.Cn)(),e),nr=rr((()=>(0,i._)("div",{id:"map"},null,-1))),dr=rr((()=>(0,i._)("div",{style:{position:"absolute",bottom:"0",left:"0",color:"black","z-index":"9999"},class:"text-h7"}," © DeCode, 2023 ",-1))),ur={class:"row no-wrap items-center"},cr={key:0,class:"col text-h6 ellipsis"},mr={key:0},pr={key:1},hr={key:2};function wr(e,t,a,l,o,s){const r=(0,i.up)("q-img"),n=(0,i.up)("q-chip"),d=(0,i.up)("q-card-section"),u=(0,i.up)("q-card"),c=(0,i.up)("q-expansion-item"),m=(0,i.up)("q-dialog");return(0,i.wg)(),(0,i.iD)("div",null,[nr,dr,(0,i.Wm)(m,{modelValue:l.toolbar,"onUpdate:modelValue":t[0]||(t[0]=e=>l.toolbar=e)},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{style:{width:"700px","max-width":"80vw"}},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{src:o.img},null,8,["src"]),(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i._)("div",ur,[o.nameSchool?((0,i.wg)(),(0,i.iD)("div",cr,(0,B.zw)(o.nameSchool),1)):(0,i.kq)("",!0)]),o.dirs?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:0},(0,i.Ko)(o.dirs,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id,style:{display:"inline-block"},class:"q-mr-sm"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e,(e=>((0,i.wg)(),(0,i.j4)(n,{size:"xm",style:(0,B.j5)([{margin:"0"},{"background-color":`${e.color}`}]),key:e.id,"text-color":"white"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(e.name),1)])),_:2},1032,["style"])))),128))])))),128)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(d,{class:"q-pt-none"},{default:(0,i.w5)((()=>[o.addressStr?((0,i.wg)(),(0,i.iD)("div",mr,(0,B.zw)(o.addressStr),1)):(0,i.kq)("",!0),o.phone?((0,i.wg)(),(0,i.iD)("div",pr,[(0,i.Uk)(" Телефон школы : "),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(o.phone,(e=>((0,i.wg)(),(0,i.iD)("div",{key:e.id},(0,B.zw)(e.value),1)))),128))])):(0,i.kq)("",!0),o.email?((0,i.wg)(),(0,i.iD)("div",hr,"E-mail: "+(0,B.zw)(o.email),1)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(c,{dence:"",label:"Описание"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(d,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,B.zw)(o.description),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var gr=a(2316);const fr={setup(){return{toolbar:(0,s.iH)(!1)}},data(){return{auth:"12GradMapAdmin345SRscx:23pdmtF334slkRDcS5EREc2",rows:[],nameSchool:"",addressStr:"",phone:"",email:"",img:"",description:"",markers:[],dirs:null}},mounted(){this.mapOpen()},methods:{async mapOpen(){const e=await(0,Co.z)(),t=new e.Map("map",{center:[37.62199313139937,55.754172570006155],zoom:8,key:"042b5b75-f847-4f2a-b695-b5f58adc9dfd"}),a=new gr.Clusterer(t,{clusterStyle:{icon:"https://docs.2gis.com/img/mapgl/cluster.svg",hoverIcon:"https://docs.2gis.com/img/mapgl/clusterHover.svg",labelColor:"#ffffff",labelFontSize:16}}),l=await b.api.get("api/school/dir/s/",{headers:{Authorization:"Basic "+btoa(this.auth),"x-requested-with":"*"}});this.rows=l.data;for(let o=0;o<this.rows.length;o++)this.markers[o]={coordinates:[this.rows[o].address.mapPos.x,this.rows[o].address.mapPos.y],id:o};a.load(this.markers),a.on("click",(e=>{if("marker"==e.target.type){let t=e.target.data.id;this.toolbar=!0,this.nameSchool=this.rows[t].name??null,this.addressStr=this.rows[t].address?this.rows[t].address.address_str:null,this.phone=this.rows[t].contacts?this.rows[t].contacts.phone:null,this.email=this.rows[t].contacts?this.rows[t].contacts.mail:null,this.img=this.rows[t].image_url??null,this.description=this.rows[t].description??null,this.dirs=this.rows[t].dir??null}else t.setCenter(e.lngLat),t.setZoom(t.getZoom()+2)}))}}};var yr=a(1123);const _r=(0,d.Z)(fr,[["render",wr],["__scopeId","data-v-7e8aa9eb"]]),br=_r;function vr(e,t,a,l,o,s){const r=(0,i.up)("Map"),n=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(n,{style:{position:"absolute",left:"0",right:"0",top:"0",bottom:"0","margin-bottom":"24px"}},{default:(0,i.w5)((()=>[((0,i.wg)(),(0,i.j4)(r,{class:"mapframe",key:Date.now()}))])),_:1})}E()(fr,"components",{QDialog:Ra.Z,QCard:W.Z,QImg:L.Z,QCardSection:x.Z,QChip:Dl.Z,QExpansionItem:yr.Z});const Vr={components:{Map:br}},kr=(0,d.Z)(Vr,[["render",vr],["__scopeId","data-v-700a6f3d"]]),Wr=kr;E()(Vr,"components",{QCard:W.Z});const xr=[{path:"/map",component:br,name:"map"},{path:"/auth",component:F,name:"auth",children:[{path:"login",name:"login",component:N},{path:"registr",name:"registr",component:M}]},{path:"/",component:fe,children:[{path:"statistic",name:"statistic",component:Ua},{path:"dataedit",name:"dataedit",component:Ai},{path:"techsupport",name:"techsupport",component:Gi},{path:"profile",name:"profile",component:ir},{path:"/schoolmap",component:Wr,name:"map_inside"}],beforeEnter:(e,t)=>{if(!V().get("token")&&"auth"!==e.name)return{name:"auth"}},beforeUpdate(e,t){if(!V().get("token")&&"auth"!==e.name)return{name:"auth"}}},{path:"/:catchAll(.*)*",component:Me}],qr=xr,Sr=(0,m.BC)((function(){const e=p.r5,t=(0,p.p7)({scrollBehavior:()=>({left:0,top:0}),routes:qr,history:e("")});return t}));async function Ur(e,t){const a=e(c);a.use(o.Z,t);const l=(0,s.Xl)("function"===typeof Sr?await Sr({}):Sr);return{app:a,router:l}}var Dr=a(5943),Cr=a(4328);const Er={config:{},lang:Dr.Z,plugins:{Notify:Cr.Z}},Tr="";async function Mr({app:e,router:t},a){let l=!1;const o=e=>{try{return t.resolve(e).href}catch(a){}return Object(e)===e?null:e},s=e=>{if(l=!0,"string"===typeof e&&/^https?:\/\//.test(e))return void(window.location.href=e);const t=o(e);null!==t&&(window.location.href=t,window.location.reload())},i=window.location.href.replace(window.location.origin,"");for(let n=0;!1===l&&n<a.length;n++)try{await a[n]({app:e,router:t,ssrContext:null,redirect:s,urlPath:i,publicPath:Tr})}catch(r){return r&&r.url?void s(r.url):void console.error("[Quasar] boot error:",r)}!0!==l&&(e.use(t),e.mount("#q-app"))}Ur(l.ri,Er).then((e=>{const[t,l]=void 0!==Promise.allSettled?["allSettled",e=>e.map((e=>{if("rejected"!==e.status)return e.value.default;console.error("[Quasar] boot error:",e.reason)}))]:["all",e=>e.map((e=>e.default))];return Promise[t]([Promise.resolve().then(a.bind(a,1569))]).then((t=>{const a=l(t).filter((e=>"function"===typeof e));Mr(e,a)}))}))},1569:(e,t,a)=>{"use strict";a.r(t),a.d(t,{api:()=>s,default:()=>i});var l=a(3340),o=a(7524);const s=o.Z.create({baseURL:"https://graduate-map.ru/"}),i=(0,l.xr)((({app:e})=>{e.config.globalProperties.$axios=o.Z,e.config.globalProperties.$api=s}))},913:(e,t,a)=>{e.exports=a.p+"img/404безошибкиcпузырями.f51fba76.svg"},2778:(e,t,a)=>{e.exports=a.p+"img/Logo.0208df60.svg"},577:(e,t,a)=>{e.exports=a.p+"img/LogoInside.6be75fb5.svg"},918:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGRhdGEtbmFtZT0iTGF5ZXIgMSIgd2lkdGg9IjY0Ny42MzYyNiIgaGVpZ2h0PSI2MzIuMTczODMiIHZpZXdCb3g9IjAgMCA2NDcuNjM2MjYgNjMyLjE3MzgzIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PHBhdGggZD0iTTY4Ny4zMjc5LDI3Ni4wODY5MUg1MTIuODE4MTNhMTUuMDE4MjgsMTUuMDE4MjgsMCwwLDAtMTUsMTV2Mzg3Ljg1bC0yLC42MTAwNS00Mi44MTAwNiwxMy4xMWE4LjAwNjc2LDguMDA2NzYsMCwwLDEtOS45ODk3NC01LjMxTDMxNS42NzgsMjcxLjM5NjkxYTguMDAzMTMsOC4wMDMxMywwLDAsMSw1LjMxMDA2LTkuOTlsNjUuOTcwMjItMjAuMiwxOTEuMjUtNTguNTQsNjUuOTY5NzItMjAuMmE3Ljk4OTI3LDcuOTg5MjcsMCwwLDEsOS45OTAyNCw1LjNsMzIuNTQ5OCwxMDYuMzJaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjc2LjE4MTg3IC0xMzMuOTEzMDkpIiBmaWxsPSIjZjJmMmYyIi8+PHBhdGggZD0iTTcyNS40MDgsMjc0LjA4NjkxbC0zOS4yMy0xMjguMTRhMTYuOTkzNjgsMTYuOTkzNjgsMCwwLDAtMjEuMjMtMTEuMjhsLTkyLjc1LDI4LjM5TDM4MC45NTgyNywyMjEuNjA2OTNsLTkyLjc1LDI4LjRhMTcuMDE1MiwxNy4wMTUyLDAsMCwwLTExLjI4MDI4LDIxLjIzbDEzNC4wODAwOCw0MzcuOTNhMTcuMDI2NjEsMTcuMDI2NjEsMCwwLDAsMTYuMjYwMjYsMTIuMDMsMTYuNzg5MjYsMTYuNzg5MjYsMCwwLDAsNC45Njk3Mi0uNzVsNjMuNTgwMDgtMTkuNDYsMi0uNjJ2LTIuMDlsLTIsLjYxLTY0LjE2OTkyLDE5LjY1YTE1LjAxNDg5LDE1LjAxNDg5LDAsMCwxLTE4LjczLTkuOTVsLTEzNC4wNjk4My00MzcuOTRhMTQuOTc5MzUsMTQuOTc5MzUsMCwwLDEsOS45NDk3MS0xOC43M2w5Mi43NS0yOC40LDE5MS4yNDAyNC01OC41NCw5Mi43NS0yOC40YTE1LjE1NTUxLDE1LjE1NTUxLDAsMCwxLDQuNDA5NjYtLjY2LDE1LjAxNDYxLDE1LjAxNDYxLDAsMCwxLDE0LjMyMDMyLDEwLjYxbDM5LjA0OTgsMTI3LjU2LjYyMDEyLDJoMi4wODAwOFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzYuMTgxODcgLTEzMy45MTMwOSkiIGZpbGw9IiMzZjNkNTYiLz48cGF0aCBkPSJNMzk4Ljg2Mjc5LDI2MS43MzM4OWE5LjAxNTcsOS4wMTU3LDAsMCwxLTguNjExMzMtNi4zNjY3bC0xMi44ODAzNy00Mi4wNzE3OGE4Ljk5ODg0LDguOTk4ODQsMCwwLDEsNS45NzEyLTExLjI0MDIzbDE3NS45MzktNTMuODYzNzdhOS4wMDg2Nyw5LjAwODY3LDAsMCwxLDExLjI0MDcyLDUuOTcwN2wxMi44ODAzNyw0Mi4wNzIyN2E5LjAxMDI5LDkuMDEwMjksMCwwLDEtNS45NzA3LDExLjI0MDcyTDQwMS40OTIxOSwyNjEuMzM4ODdBOC45NzYsOC45NzYsMCwwLDEsMzk4Ljg2Mjc5LDI2MS43MzM4OVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzYuMTgxODcgLTEzMy45MTMwOSkiIGZpbGw9IiM5NUFGM0QiLz48Y2lyY2xlIGN4PSIxOTAuMTUzNTEiIGN5PSIyNC45NTQ2NSIgcj0iMjAiIGZpbGw9IiM5NUFGM0QiLz48Y2lyY2xlIGN4PSIxOTAuMTUzNTEiIGN5PSIyNC45NTQ2NSIgcj0iMTIuNjY0NjIiIGZpbGw9IiNmZmYiLz48cGF0aCBkPSJNODc4LjgxODM2LDcxNi4wODY5MWgtMzM4YTguNTA5ODEsOC41MDk4MSwwLDAsMS04LjUtOC41di00MDVhOC41MDk1MSw4LjUwOTUxLDAsMCwxLDguNS04LjVoMzM4YTguNTA5ODIsOC41MDk4MiwwLDAsMSw4LjUsOC41djQwNUE4LjUxMDEzLDguNTEwMTMsMCwwLDEsODc4LjgxODM2LDcxNi4wODY5MVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzYuMTgxODcgLTEzMy45MTMwOSkiIGZpbGw9IiNlNmU2ZTYiLz48cGF0aCBkPSJNNzIzLjMxODEzLDI3NC4wODY5MWgtMjEwLjVhMTcuMDI0MTEsMTcuMDI0MTEsMCwwLDAtMTcsMTd2NDA3LjhsMi0uNjF2LTQwNy4xOWExNS4wMTgyOCwxNS4wMTgyOCwwLDAsMSwxNS0xNUg3MjMuOTM4MjVabTE4My41LDBoLTM5NGExNy4wMjQxMSwxNy4wMjQxMSwwLDAsMC0xNywxN3Y0NThhMTcuMDI0MSwxNy4wMjQxLDAsMCwwLDE3LDE3aDM5NGExNy4wMjQxLDE3LjAyNDEsMCwwLDAsMTctMTd2LTQ1OEExNy4wMjQxMSwxNy4wMjQxMSwwLDAsMCw5MDYuODE4MTMsMjc0LjA4NjkxWm0xNSw0NzVhMTUuMDE4MjgsMTUuMDE4MjgsMCwwLDEtMTUsMTVoLTM5NGExNS4wMTgyOCwxNS4wMTgyOCwwLDAsMS0xNS0xNXYtNDU4YTE1LjAxODI4LDE1LjAxODI4LDAsMCwxLDE1LTE1aDM5NGExNS4wMTgyOCwxNS4wMTgyOCwwLDAsMSwxNSwxNVoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yNzYuMTgxODcgLTEzMy45MTMwOSkiIGZpbGw9IiMzZjNkNTYiLz48cGF0aCBkPSJNODAxLjgxODM2LDMxOC4wODY5MWgtMTg0YTkuMDEwMTUsOS4wMTAxNSwwLDAsMS05LTl2LTQ0YTkuMDEwMTYsOS4wMTAxNiwwLDAsMSw5LTloMTg0YTkuMDEwMTYsOS4wMTAxNiwwLDAsMSw5LDl2NDRBOS4wMTAxNSw5LjAxMDE1LDAsMCwxLDgwMS44MTgzNiwzMTguMDg2OTFaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjc2LjE4MTg3IC0xMzMuOTEzMDkpIiBmaWxsPSIjQ0VBNjlBIi8+PGNpcmNsZSBjeD0iNDMzLjYzNjI2IiBjeT0iMTA1LjE3MzgzIiByPSIyMCIgZmlsbD0iI0NFQTY5QSIvPjxjaXJjbGUgY3g9IjQzMy42MzYyNiIgY3k9IjEwNS4xNzM4MyIgcj0iMTIuMTgxODciIGZpbGw9IiNmZmYiLz48L3N2Zz4NCg=="},2822:(e,t,a)=>{e.exports=a.p+"img/Доставкаписемv2.0301c840.svg"},2796:(e,t,a)=>{e.exports=a.p+"img/Уваснедостаточноправv2.de37a071.svg"}},t={};function a(l){var o=t[l];if(void 0!==o)return o.exports;var s=t[l]={exports:{}};return e[l].call(s.exports,s,s.exports,a),s.exports}a.m=e,(()=>{var e=[];a.O=(t,l,o,s)=>{if(!l){var i=1/0;for(u=0;u<e.length;u++){for(var[l,o,s]=e[u],r=!0,n=0;n<l.length;n++)(!1&s||i>=s)&&Object.keys(a.O).every((e=>a.O[e](l[n])))?l.splice(n--,1):(r=!1,s<i&&(i=s));if(r){e.splice(u--,1);var d=o();void 0!==d&&(t=d)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[l,o,s]}})(),(()=>{a.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return a.d(t,{a:t}),t}})(),(()=>{a.d=(e,t)=>{for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{a.p=""})(),(()=>{var e={143:0};a.O.j=t=>0===e[t];var t=(t,l)=>{var o,s,[i,r,n]=l,d=0;if(i.some((t=>0!==e[t]))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(n)var u=n(a)}for(t&&t(l);d<i.length;d++)s=i[d],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(u)},l=globalThis["webpackChunkclients"]=globalThis["webpackChunkclients"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))})();var l=a.O(void 0,[736],(()=>a(4040)));l=a.O(l)})();